"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2838],{2838:(W,h,_)=>{_.r(h),_.d(h,{MttoWinOrdenTrabajo2Page:()=>x});var l=_(5861),m=_(6895),p=_(433),r=_(5562),b=_(1141),T=_(8534),t=_(8256),P=_(1456),A=_(849),O=_(1407),M=_(7883);const C=["listenerOut"];function Z(c,d){if(1&c){const o=t.EpF();t.TgZ(0,"ion-item-divider",15)(1,"ion-label"),t._uU(2,"\xa0"),t.TgZ(3,"strong"),t._uU(4),t.qZA()(),t.TgZ(5,"ion-chip",8),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.agregarItem(i))}),t.TgZ(6,"ion-label"),t._uU(7,"Agregar"),t.qZA(),t._UZ(8,"ion-icon",9),t.qZA()()}if(2&c){const o=t.oxw().$implicit;t.xp6(4),t.Oqu(o.nomclase)}}function E(c,d){if(1&c){const o=t.EpF();t.TgZ(0,"ion-item",16)(1,"ion-badge",17),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",18),t.NdJ("click",function(i){t.CHM(o);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FItemEliminar(i,a))}),t._uU(4," Quitar "),t._UZ(5,"ion-icon",19),t.qZA(),t.TgZ(6,"ion-toggle",20),t.NdJ("ionChange",function(i){t.CHM(o);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FasignaServicio(i,a))}),t.TgZ(7,"p",21)(8,"ion-badge",22),t._uU(9),t.qZA(),t.TgZ(10,"ion-text",23),t._uU(11),t.qZA(),t._uU(12," Cnt.Teorica: "),t.TgZ(13,"ion-text",24),t._uU(14),t.qZA()()(),t.TgZ(15,"ion-input",25),t.NdJ("ngModelChange",function(i){t.CHM(o);const a=t.oxw().$implicit;return t.KtG(a.otd_cantidad=i)})("ionBlur",function(i){t.CHM(o);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FBlourInput(i,a))}),t.qZA()()}if(2&c){const o=t.oxw().$implicit;t.xp6(2),t.hij("",o.orden1,".-"),t.xp6(4),t.Q6J("disabled","0"===o.habilitar_toggle)("checked","1"===o.check_toggle),t.xp6(2),t.s9C("color",o.color_atendido),t.xp6(1),t.Oqu(o.estado_abre),t.xp6(2),t.Oqu(o.nomclase),t.xp6(3),t.Oqu(o.otd_cantidad_plan),t.xp6(1),t.Q6J("disabled","0"===o.habilitar_input)("ngModel",o.otd_cantidad)}}function v(c,d){if(1&c&&(t.TgZ(0,"ion-item-group"),t.YNc(1,Z,9,1,"ion-item-divider",13),t.YNc(2,E,16,9,"ion-item",14),t.qZA()),2&c){const o=d.$implicit;t.xp6(1),t.Q6J("ngIf","1"===o.orden),t.xp6(1),t.Q6J("ngIf","2"===o.orden)}}let x=(()=>{class c{constructor(o,e,i,a,n,s,f,g,D,y,I){let u;this.navCtrl=o,this.loadingController=e,this.ApiService=i,this.storage=a,this.alertController=n,this.router=s,this.globalVal=f,this.ref=g,this.actionSheetCtrl=D,this.toastController=y,this.modalCtrl=I,this.DsServiciosxPieza={},this.ValuesAcordionGroup=["551571","551579"],this.itemsAcum=0,this.disabledBusquedaPartList=!0,this.storage.get("USER_INFO").then(U=>{u=U,this.NombresUsuarioLocal=u.user_name,this.IdUsuarioLocal=u.user_id,this.storage.get("DEVICE_INFO").then(L=>{u=L,this.NombreDispositivo=u.name,this.IdDispositivo=u.uuid})}),this.disabledBusquedaPartList="R"!==this.globalVal.fab_rep}ngAfterViewInit(){this.itemsAcum=0}ngOnInit(){this.itemsAcum=0}get autoIncrement(){let o=0;for(const e of this.EditDataRest)"1"===e.item&&(o+=1);return o}ionViewWillEnter(){this.itemsAcum=0,this.FLoadPiezasAcordion()}FLoadPiezasAcordion(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(e=>{e.present(),this.ApiService.ListRepuestosxBomba(this.globalVal.id_orden_trab_cab,this.IdUsuarioLocal).then(i=>{let a=0;this.itemsAcum=0,this.EditDataRest=i,console.log(this.EditDataRest),this.EditDataRest.forEach(n=>{"1"===n.item&&(this.itemsAcum++,this.EditDataRest[a].orden1=this.itemsAcum,this.mttoNombrePartList=this.EditDataRest[a].nombre_partlist_otc),a++})}).finally(()=>{this.loadingController.dismiss()})})}presentToast(o){var e=this;return(0,l.Z)(function*(){console.log("ingreso toast"),yield(yield e.toastController.create({message:o,duration:1500,position:"bottom"})).present()})()}FasignaServicio(o,e){var i=this;return(0,l.Z)(function*(){console.log(o),e.check_toggle=o.detail.checked?"1":"0",e.habilitar_input=o.detail.checked?"1":"0",yield i.ApiService.GuardarFormPaso2(e,i.IdUsuarioLocal).then(function(){var n=(0,l.Z)(function*(s){console.log(s),i.presentToast(s[0].o_msj),"1"==s[0].o_nres&&(e.otd_cantidad=e.otd_cantidad_plan)});return function(s){return n.apply(this,arguments)}}()).finally(()=>{}).catch(n=>{console.log("errror:::>>>>>>>>>",n)})})()}FBlourInput(o,e){var i=this;return(0,l.Z)(function*(){console.log(o),yield i.ApiService.GuardarFormPaso2(e,i.IdUsuarioLocal).then(function(){var n=(0,l.Z)(function*(s){console.log(s),i.presentToast(s[0].o_msj)});return function(s){return n.apply(this,arguments)}}()).finally(()=>{}).catch(n=>{console.log("errror:::>>>>>>>>>",n)}),o.preventDefault()})()}agregarItem(o){var e=this;return(0,l.Z)(function*(){console.log(o);const i=yield e.modalCtrl.create({component:b.MttoOtisPopUpAddItemPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:o}});return i.onDidDismiss().then(function(){var a=(0,l.Z)(function*(n){e.FLoadPiezasAcordion(),null!==n&&(e.dataReturned=n.data,console.log("Modal Sent Data :",e.dataReturned),"1"==n.data.o_nres||console.log("no guardo nada"))});return function(n){return a.apply(this,arguments)}}()),yield i.present()})()}agregarItemSinPieza(){this.agregarItem({idclase:0,nomclase:"Sin Pieza Definida",rs:"1",id_orden_trab_cab:this.globalVal.id_orden_trab_cab})}mostrarConfirmacion(){var o=this;return(0,l.Z)(function*(){yield(yield o.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea realizar esta acci\xf3n?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{o.SaveFormTerminadoPaso1()}}]})).present()})()}SaveFormTerminadoPaso1(){var o=this;return(0,l.Z)(function*(){o.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(i=>{i.present()}),yield o.ApiService.GuardarOtTerminado(o.globalVal.id_orden_trab_cab,o.IdUsuarioLocal).then(function(){var i=(0,l.Z)(function*(a){o.loadingController.dismiss(),console.log(a);let n="0"==a[0].o_nres?"alerta-error":"alerta-ok";yield(yield o.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:n,mode:"ios",animated:!0,message:a[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada"),"1"==a[0].o_nres&&o.navCtrl.navigateForward(["mtto-list-orden-trabajo"])}}]})).present()});return function(a){return i.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(i=>{console.log("errror:::>>>>>>>>>",i)})})()}FItemEliminar(o,e){var i=this;return(0,l.Z)(function*(){console.log(o,e),yield(yield i.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea quitar el item seleccionado?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{i.FQuitarItem(e)}}]})).present()})()}FQuitarItem(o){var e=this;return(0,l.Z)(function*(){e.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(n=>{n.present()});const a=[o];console.log('// Recorre el array y agrega la columna "idusuario" a cada objeto',o),a.forEach(n=>{n.IdUsuarioLocal=e.IdUsuarioLocal,n.acc=30}),console.log(a),yield e.ApiService.FQuitarItem(a[0]).then(function(){var n=(0,l.Z)(function*(s){if(e.loadingController.dismiss(),console.log(s),e.presentToast(s[0].o_msj),console.log(s[0].o_nres),"1"==s[0].o_nres){const g=e.EditDataRest.indexOf(o);g>-1&&e.EditDataRest.splice(g,1)}});return function(s){return n.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(n=>{console.log("errror:::>>>>>>>>>",n)})})()}cambiarPartList(){var o=this;return(0,l.Z)(function*(){let e={IdUsuarioLocal:o.IdUsuarioLocal,id_orden_trab_cab:o.globalVal.id_orden_trab_cab};const i=yield o.modalCtrl.create({component:T.MttoOtisPopUpAddPartListPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:e}});return i.onDidDismiss().then(function(){var a=(0,l.Z)(function*(n){o.FLoadPiezasAcordion(),null!==n&&(o.dataReturned=n.data,console.log("Modal Sent Data :",o.dataReturned),o.mttoNombrePartList=n.data.tipofuente,o.globalVal.nombre_partlist_otc=n.data.configuracion,"1"==n.data.o_nres||console.log("no guardo nada"))});return function(n){return a.apply(this,arguments)}}()),yield i.present()})()}}return c.\u0275fac=function(o){return new(o||c)(t.Y36(r.SH),t.Y36(r.HT),t.Y36(P.k),t.Y36(A.K),t.Y36(r.Br),t.Y36(O.F0),t.Y36(M.X),t.Y36(t.sBO),t.Y36(r.BX),t.Y36(r.yF),t.Y36(r.IN))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-mtto-win-orden-trabajo2"]],viewQuery:function(o,e){if(1&o&&t.Gf(C,7),2&o){let i;t.iGM(i=t.CRH())&&(e.listenerOut=i.first)}},standalone:!0,features:[t.jDz],decls:24,vars:4,consts:[["mode","ios"],["slot","start"],["color","success",3,"ngModel"],["slot","end",3,"disabled","click"],["name","search","slot","end"],[2,"padding","0px","border","0px"],["slot","end","color","primary",3,"click"],["name","refresh-outline"],["slot","end","mode","ios","color","primary",3,"click"],["name","add"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["fill","outline","expand","full","color","success",3,"disabled","click"],["button","true","class","divider",4,"ngIf"],["style","border-style: hidden",4,"ngIf"],["button","true",1,"divider"],[2,"border-style","hidden"],["slot","start","color","medium","no-padding",""],["color","danger","slot","start","no-padding","",2,"margin-inline-end","2px",3,"click"],["name","trash","slot","start"],["mode","ios","labelPlacement","start",2,"width","98%","border-style","hidden",3,"disabled","checked","ionChange"],[2,"font-size","small","width","100%"],["slot","end","no-padding","",3,"color"],["color","primary"],["color","secondary"],["slot","end","type","number",2,"text-align","end","height","35px !important","width","13%","border-color","black","margin-inline-start","2px","border","1px",3,"disabled","ngModel","ngModelChange","ionBlur"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-note",1),t._uU(4,"PartList:"),t.qZA(),t._UZ(5,"ion-input",2),t.TgZ(6,"ion-button",3),t.NdJ("click",function(){return e.cambiarPartList()}),t._UZ(7,"ion-icon",4),t._uU(8," Buscar "),t.qZA()(),t.TgZ(9,"ion-item",5)(10,"ion-chip",6),t.NdJ("click",function(){return e.FLoadPiezasAcordion()}),t._UZ(11,"ion-icon",7),t.TgZ(12,"ion-label"),t._uU(13,"Actualizar"),t.qZA()(),t.TgZ(14,"ion-chip",8),t.NdJ("click",function(){return e.agregarItemSinPieza()}),t.TgZ(15,"ion-label"),t._uU(16,"Agregar"),t.qZA(),t._UZ(17,"ion-icon",9),t.qZA()()()(),t.TgZ(18,"ion-content",10)(19,"ion-list"),t.YNc(20,v,3,2,"ion-item-group",11),t.qZA()(),t.TgZ(21,"ion-footer")(22,"ion-button",12),t.NdJ("click",function(){return e.mostrarConfirmacion()}),t._uU(23,"Terminado"),t.qZA()()),2&o&&(t.xp6(5),t.Q6J("ngModel",e.mttoNombrePartList),t.xp6(1),t.Q6J("disabled",e.disabledBusquedaPartList),t.xp6(14),t.Q6J("ngForOf",e.EditDataRest),t.xp6(2),t.Q6J("disabled",e.globalVal.ot_estado_general>"2"))},dependencies:[r.Pc,r.yp,r.YG,r.hM,r.W2,r.fr,r.Gu,r.gu,r.pK,r.Ie,r.rH,r.Ub,r.Q$,r.q_,r.uN,r.yW,r.ho,r.sr,r.w,r.as,r.j9,m.ez,m.sg,m.O5,p.u5,p.JJ,p.On],styles:[".divider[_ngcontent-%COMP%]{color:#000;font-weight:700;background-color:#d7d8da;padding:0!important;border-radius:5px;border-width:2px;font-weight:bolder}"]}),c})()}}]);