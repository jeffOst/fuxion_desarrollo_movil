"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7862],{7862:(J,T,l)=>{l.r(T),l.d(T,{MttoWinRecinadoTab2Page:()=>K});var g=l(5861),M=l(6814),n=l(6728),F=l(2087),h=l(8162),A=(l(2726),l(8762)),i=l(95),f=l(1461),t=l(6242),y=l(5472),O=l(4248),B=l(7941),U=l(2014),Z=l(9862);const S=["myTabs"],q=["filePicker"],W=["fileInput"];function k(c,D){if(1&c){const m=t.EpF();t.TgZ(0,"ion-datetime",17),t.NdJ("ngModelChange",function(o){t.CHM(m);const a=t.oxw();return t.KtG(a.fchregistro=o)}),t.qZA()}if(2&c){const m=t.oxw();t.Q6J("preferWheel",!0)("showDefaultButtons",!0)("ngModel",m.fchregistro)}}const C=c=>({"is-invalid":c});let K=(()=>{var c;class D{constructor(e,o,a,r,s,d,_,p,R,E,u,L,Y,x){this.navCtrl=e,this.formBuilder=o,this.loadingController=a,this.route=r,this.api=s,this.modalCtrl=d,this.plt=_,this.alertController=p,this.toastController=R,this.actionSheetController=E,this.actionSheetCtrl=u,this.ref=L,this.storage=Y,this.http=x,this.images=[],this.photos=[],this.PHOTO_STORAGE="photos",this.correlativo="000000",this.fchactual=(new Date).toISOString(),this.DirectorioFotos="../aw_file/adjuntos/img_recinado/",this.convertBlobToBase64=j=>new Promise((z,$)=>{this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(I=>{I.present()}),new FileReader;let P=(0,F.y3)();P.readAsDataURL(j),P.onload=I=>{let b,w=I.target.result;console.log("url__;;",w),b=w,console.log("filePath::",b),b=this.dataURLtoBlob(b),console.log("correctPath::<<<<<>>>>",void 0),this.api.uploadImage(b,this.FormRecinado.value.idrecinadocablecab,"png").subscribe(v=>{this.loadingController.dismiss(),this.loadImages(this.FormRecinado.value.idrecinadocablecab),console.log("salio okkkk::",v)},v=>{console.log("error__::>",v)})}}).finally(()=>{console.log("convertBlobToBase64:::",this.convertBlobToBase64)}),this.FormRecinado=this.formBuilder.group({correlativo:new i.NI("",i.kI.required),fchregistro:new i.NI("",i.kI.required),codsmg:new i.NI("",i.kI.required),idestadoinspeccion:new i.NI("",i.kI.required),idrecinadocablecab:new i.NI("0",i.kI.required),metraje_inspeccion1:new i.NI("",i.kI.required),metraje_inspeccion2:new i.NI(""),detalle_rcd1:new i.NI(""),detalle_rcd2:new i.NI(""),reclamo_rcd1:new i.NI("0",i.kI.required),reclamo_rcd2:new i.NI("0"),idestadocable_rcd1:new i.NI("",i.kI.required),idestadocable_rcd2:new i.NI(""),ca1_mts_pp1:new i.NI("0",i.kI.required),ca1_mts_pp2:new i.NI("0"),fch_reg_ot_rcc:new i.NI("",i.kI.required),tipo_cable1:new i.NI("",i.kI.required),tipo_cable2:new i.NI(""),nroot:new i.NI("",i.kI.required),aislamiento1:new i.NI("",i.kI.required),aislamiento2:new i.NI(""),termistor_m1:new i.NI("",i.kI.required),termistor_m2:new i.NI(""),termistor_t1:new i.NI("",i.kI.required),termistor_t2:new i.NI(""),diagnostico1:new i.NI("",i.kI.required),diagnostico2:new i.NI(""),ca1_codigo_rcc:new i.NI("",i.kI.required),ca2_codigo_rcc:new i.NI("")}),this.DirectorioFotos=this.api.DirectorioImg,this.ClsId=this.route.snapshot.paramMap.get("id"),this.fchregistro=(new Date).toISOString()}ngOnInit(){var e=this;return(0,g.Z)(function*(){let o;(e.plt.is("mobile")&&e.plt.is("hybrid")||e.plt.is("desktop"))&&(e.isDesktop=!0),e.api.list_tipo_cable().subscribe(a=>{console.log("ingreso lista cables",a),e.rest_tipo_cables=a.tcable,e.rest_diagnosticos=a.diagnostico,e.rest_estados=a.estcable,e.ref.detectChanges()}),e.fchactual=(new Date).toISOString(),console.log("this.fchactual::",e.fchactual),e.storage.get("USER_INFO").then(a=>{o=a,e.NomUsuario=o.user_name,console.log("localStorage.user_id;:::",o.user_id),e.api.load_form_insp_cable(e.ClsId,o.user_id).then(r=>{console.log("this.ClsId",e.ClsId),"0"==e.ClsId?e.NewInspeccionLoad(r):(e.EditarInspeccionLoad(r),e.selectedTextTCable1(1),e.selectedTextTCable2(1),e.selectedTextDiagnostico1(1),e.selectedTextDiagnostico2(1),e.selectedTextTCable3(1))})}).finally(()=>{console.log("localStorage.user_id;:::finally:::",o.user_id)}),e.plt.ready().then(()=>{})})()}SaveFormInsp(){if(this.FormRecinado.valid)this.alertSiNo=this.alertController.create({header:"Agregar Inspeccion Cable",subHeader:"",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea guardar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(e=>{e.present(),e.onDidDismiss().then(o=>{console.log("aceptaPop::::>>",o),"A"==o.role&&this.api.GuardarFormulario(this.FormRecinado.value).then(a=>{console.log("res:::>>>>>>>>>",a)}).finally(()=>{this.navCtrl.navigateForward(["mtto-list-recinado"])}).catch(a=>{console.log("errror:::>>>>>>>>>",a)})})});else{console.log(this.FormRecinado.valid),console.log(this.FormRecinado);for(let e in this.FormRecinado.controls)this.FormRecinado.controls[e].setValue(this.FormRecinado.controls[e].value),this.FormRecinado.controls[e].markAsTouched();this.alertSiNo=this.alertController.create({header:"Agregar Recinado Cable",subHeader:"",mode:"ios",backdropDismiss:!0,message:"Falta seleccionar todos los datos",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}}]}).then(e=>{e.present(),e.onDidDismiss().then(o=>{})})}}NewInspeccionLoad(e){this.EditDataRest=e,console.log("newinspeccion",this.EditDataRest[0]),console.log("newinspeccion",this.EditDataRest),this.idrecinadocablecab=this.EditDataRest[0].idrecinadocablecab,this.FormRecinado.value.idrecinadocablecab=this.EditDataRest[0].idrecinadocablecab,this.correlativo=this.EditDataRest[0].correlativo_rcc,this.fchregistro=new Date(this.EditDataRest[0].fchregistro_rcc).toISOString(),this.ref.detectChanges()}EditarInspeccionLoad(e){this.EditDataRest=e,console.log("jeffrey verifica aqui"),console.log("this.EditDataRest ",this.EditDataRest);try{this.FormRecinado.setValue({idrecinadocablecab:this.EditDataRest[0].idrecinadocablecab,correlativo:this.EditDataRest[0].correlativo_rcc,fchregistro:new Date(this.EditDataRest[0].fchregistro_rcc).toISOString(),codsmg:this.EditDataRest[0].codsmg,idestadoinspeccion:this.EditDataRest[0].idestado_rcc,ca1_mts_pp1:this.EditDataRest[0].metraje_pp_rcd,ca1_mts_pp2:this.EditDataRest[1].metraje_pp_rcd,metraje_inspeccion1:this.EditDataRest[0].metraje_rcd,metraje_inspeccion2:this.EditDataRest[1].metraje_rcd,tipo_cable1:this.EditDataRest[0].tipocable_rcd,tipo_cable2:this.EditDataRest[1].tipocable_rcd,idestadocable_rcd1:this.EditDataRest[0].idestadocable_rcd,idestadocable_rcd2:this.EditDataRest[1].idestadocable_rcd,reclamo_rcd1:this.EditDataRest[0].reclamo_rcd,reclamo_rcd2:this.EditDataRest[1].reclamo_rcd,detalle_rcd1:this.EditDataRest[0].detalle_rcd,detalle_rcd2:this.EditDataRest[1].detalle_rcd,fch_reg_ot_rcc:new Date(this.EditDataRest[0].fch_reg_ot_rcc).toISOString(),nroot:this.EditDataRest[1].nroot,aislamiento1:this.EditDataRest[0].aislamiento,aislamiento2:this.EditDataRest[1].aislamiento,termistor_m1:this.EditDataRest[0].thermistor_m,termistor_m2:this.EditDataRest[1].thermistor_m,termistor_t1:this.EditDataRest[0].thermistor_n,termistor_t2:this.EditDataRest[1].thermistor_n,diagnostico1:this.EditDataRest[0].diagnostico,diagnostico2:this.EditDataRest[1].diagnostico,ca1_codigo_rcc:this.EditDataRest[1].ca1_codigo_rcc,ca2_codigo_rcc:this.EditDataRest[1].ca2_codigo_rcc})}catch(o){console.log("error:::>",o)}console.log(":::this.FormRecinado.value.idrecinadocablecab:::::::::::::::>>"),this.loadImages(this.FormRecinado.value.idrecinadocablecab),console.log("<<<<::::::::::::::::::>>")}selectedTextTCable3(e){let o=null;return 1==e&&(console.log("this.rest_estados que rao no",this.rest_estados),this.rest_estados.forEach(a=>{console.log("this.FormRecinado.get(idestadocable_rcd1).value",this.FormRecinado.get("idestadocable_rcd1").value),this.FormRecinado.get("idestadocable_rcd1").value==a.codigo&&(o=a.nombre)})),o}selectedTextTCable1(e){let o=null;return 1==e&&this.rest_tipo_cables.forEach(a=>{this.FormRecinado.get("tipo_cable1").value==a.id&&(o=a.nombre)}),o}selectedTextTCable2(e){let o=null;return 1==e&&(console.log("this.rest_tipo_cables",this.rest_tipo_cables),this.rest_tipo_cables.forEach(a=>{this.FormRecinado.get("tipo_cable2").value==a.id&&(o=a.nombre)})),o}selectedTextDiagnostico1(e){let o=null;return 1==e&&this.rest_diagnosticos.forEach(a=>{console.log("this.FormRecinado.get(diagnostico1).value",this.FormRecinado.get("diagnostico1").value),this.FormRecinado.get("diagnostico1").value==a.id&&(o=a.nombre)}),o}selectedTextDiagnostico2(e){let o=null;return 1==e&&this.rest_diagnosticos.forEach(a=>{this.FormRecinado.get("diagnostico2").value==a.id&&(o=a.nombre)}),o}open_popup_equipos(){var e=this;return(0,g.Z)(function*(){const o=yield e.modalCtrl.create({component:A.PopUpEquRecinadoPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{idvaleservidetot_p:0}});return o.onDidDismiss().then(a=>{null!==a&&(e.dataReturned=a.data,e.fch_reg_ot_rcc=a.data.fch_inicio_ot,e.nroot=a.data.id_orden_trab_fis_cab,e.codsmg1=a.data.idequipo)}),yield o.present()})()}loadImages(e){this.api.getImages(e).subscribe(o=>{this.images=o,this.ref.detectChanges()})}selectImageSource(){var e=this;return(0,g.Z)(function*(){const o=[{text:"Tome una Foto",icon:"camera",handler:()=>{console.log(h.oK.Camera),e.addNewToGallery(1)}},{text:"Elegir desde las fotos",icon:"image",handler:()=>{console.log("Photos",h.oK.Photos),e.addNewToGallery(2)}}];yield(yield e.actionSheetCtrl.create({header:"Selecionar Image",buttons:o})).present()})()}addNewToGallery(e){var o=this;return(0,g.Z)(function*(){let a;console.log("addNewToGallery::::"),1==e?a=yield h.V1.getPhoto({resultType:h.dk.Uri,source:h.oK.Camera,quality:100}).finally(()=>{console.log("capturedPhoto::::",a)}):2==e&&(a=yield h.V1.getPhoto({resultType:h.dk.Uri,source:h.oK.Photos,quality:100}).finally(()=>{console.log("capturedPhoto::::",a)})),console.log("LN {140}::::"),yield o.savePicture(a)})()}savePicture(e){var o=this;return(0,g.Z)(function*(){const a=yield o.readAsBase64(e),r=(new Date).getTime()+".jpeg";return yield f.fy.writeFile({path:r,data:a,directory:f.tP.Data}),{filepath:r,webviewPath:e.webPath}})()}readAsBase64(e){var o=this;return(0,g.Z)(function*(){const r=yield(yield fetch(e.webPath)).blob();return yield o.convertBlobToBase64(r)})()}dataURLtoBlob(e){for(var o=e.split(","),a=o[0].match(/:(.*?);/)[1],r=atob(o[1]),s=r.length,d=new Uint8Array(s);s--;)d[s]=r.charCodeAt(s);return new Blob([d],{type:a})}base64ToArrayBuffer(e){for(var o=window.atob(e),a=o.length,r=new Uint8Array(a),s=0;s<a;s++)r[s]=o.charCodeAt(s);return r.buffer}dataURLtoFile(e,o){let a=e.split(","),r=a[0].match(/:(.*?);/)[1],s=atob(a[1]),d=s.length,_=new Uint8Array(d);for(;d--;)_[d]=s.charCodeAt(d);return new File([_],o,{type:r})}loadSaved(){var e=this;return(0,g.Z)(function*(){for(let o of e.photos){const a=yield f.fy.readFile({path:o.path,directory:f.tP.Data});o.webPath=`data:image/jpeg;base64,${a.data}`}})()}uploadFile(e){}deleteImage(e,o){this.alertSiNo=this.alertController.create({header:"Agregar Inspeccion Cable",subHeader:"",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea eliminar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(a=>{a.present(),a.onDidDismiss().then(r=>{console.log("aceptaPop::::>>",r),"A"==r.role&&this.api.deleteImage(e).subscribe(s=>{this.images.splice(o,1)})})})}b64toBlob(e,o="",a=512){const r=atob(e),s=[];for(let _=0;_<r.length;_+=a){const p=r.slice(_,_+a),R=new Array(p.length);for(let u=0;u<p.length;u++)R[u]=p.charCodeAt(u);const E=new Uint8Array(R);s.push(E)}return new Blob(s,{type:o})}cancelar_ejecucion(){this.navCtrl.navigateForward("mtto-list-recinado")}load_datos(){this.loadingController.create({message:"Porfavor espere...",translucent:!0}).then(o=>{let a,r;o.present(),this.storage.get("USER_INFO").then(s=>{a=s,r=a.idtecnico}).finally(()=>{this.api.load_form_insp_cable(this.ClsId,r).then(s=>{this.ClsArForm=s,console.log(this.ClsArForm),this.loadingController.dismiss()})})})}segmentChanged(e){}select_change_estado(e){}onFileChoose(e){const o=e.target.files[0],r=new FileReader;o.type.match(/image-*/)?(r.onload=()=>{this.images.push(r.result.toString())},r.readAsDataURL(o)):console.log("File format not supported")}mySelect(e,o){}}return(c=D).\u0275fac=function(e){return new(e||c)(t.Y36(y.SH),t.Y36(i.qu),t.Y36(n.HT),t.Y36(O.gz),t.Y36(B.o),t.Y36(n.IN),t.Y36(y.t4),t.Y36(n.Br),t.Y36(n.yF),t.Y36(n.BX),t.Y36(n.BX),t.Y36(t.sBO),t.Y36(U.K),t.Y36(Z.eN))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-mtto-win-recinado-tab-2"]],viewQuery:function(e,o){if(1&e&&(t.Gf(S,5),t.Gf(q,5),t.Gf(W,5)),2&e){let a;t.iGM(a=t.CRH())&&(o.tabRef=a.first),t.iGM(a=t.CRH())&&(o.filePickerRef=a.first),t.iGM(a=t.CRH())&&(o.fileInput=a.first)}},standalone:!0,features:[t.jDz],decls:33,vars:16,consts:[["mode","ios",1,"ion-no-border","ion-text-center"],["src","assets/imgs/cable_resinado_mtto.png","width","50%"],[3,"fullscreen"],["color","primary"],["mode","ios","label","Correlativo:","label-placement","fixed","readonly","","formControlName","correlativo",3,"ngModel","ngModelChange"],[2,"display","none"],["hidden","","formControlName","idrecinadocablecab",3,"ngModel","ngModelChange"],["label","F.Registro:","locale","es-ES","datetime","datetime"],["trigger","popover-button","animated","true","arrow","true","mode","ios",3,"keepContentsMounted"],["label","Equipo:","label-placement","fixed","readonly","","formControlName","codsmg",3,"ngModel","ngClass","ngModelChange"],["slot","end","color","primary",3,"click"],["name","search-outline"],["label","Nro O.T.:","label-placement","fixed","type","text","readonly","","formControlName","nroot",3,"ngModel","ngClass","ngModelChange"],["label","Estado:","placeholder","Seleccionar uno","formControlName","idestadoinspeccion","mode","ios","interface","action-sheet",3,"ngClass"],["value","1"],["value","2"],["label","F.Reg.O.T:","label-placement","fixed","readonly","","formControlName","fch_reg_ot_rcc",3,"ngModel","ngModelChange"],["locale","es-ES","id","datetime","mode","ios","displayFormat","YYYY-MM-DD","presentation","date","formControlName","fchregistro",3,"preferWheel","showDefaultButtons","ngModel","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0),t._UZ(2,"img",1),t.qZA()(),t.TgZ(3,"ion-content",2)(4,"ion-item-group")(5,"ion-item-divider",3)(6,"ion-label"),t._uU(7,"General"),t.qZA()(),t.TgZ(8,"ion-item")(9,"ion-input",4),t.NdJ("ngModelChange",function(r){return o.correlativo=r}),t.qZA(),t.TgZ(10,"div",5)(11,"ion-input",6),t.NdJ("ngModelChange",function(r){return o.idrecinadocablecab=r}),t.qZA()()(),t.TgZ(12,"ion-item")(13,"ion-label"),t._uU(14,"F.Registro:"),t.qZA(),t._UZ(15,"ion-datetime-button",7),t.TgZ(16,"ion-popover",8),t.YNc(17,k,1,3,"ng-template"),t.qZA()(),t.TgZ(18,"ion-item")(19,"ion-input",9),t.NdJ("ngModelChange",function(r){return o.codsmg1=r}),t.qZA(),t.TgZ(20,"ion-button",10),t.NdJ("click",function(){return o.open_popup_equipos()}),t._UZ(21,"ion-icon",11),t.qZA()(),t.TgZ(22,"ion-item")(23,"ion-input",12),t.NdJ("ngModelChange",function(r){return o.nroot=r}),t.qZA()(),t.TgZ(24,"ion-item")(25,"ion-select",13)(26,"ion-select-option",14),t._uU(27,"Borrador"),t.qZA(),t.TgZ(28,"ion-select-option",15),t._uU(29,"Terminado"),t.qZA()()(),t.TgZ(30,"ion-item")(31,"ion-input",16),t.NdJ("ngModelChange",function(r){return o.fch_reg_ot_rcc=r}),t.qZA()()(),t._UZ(32,"ion-item-group"),t.qZA()),2&e&&(t.xp6(3),t.Q6J("fullscreen",!0),t.xp6(6),t.Q6J("ngModel",o.correlativo),t.xp6(2),t.Q6J("ngModel",o.idrecinadocablecab),t.xp6(5),t.Q6J("keepContentsMounted",!0),t.xp6(3),t.Q6J("ngModel",o.codsmg1)("ngClass",t.VKq(10,C,o.FormRecinado.get("codsmg").touched&&o.FormRecinado.get("codsmg").invalid)),t.xp6(4),t.Q6J("ngModel",o.nroot)("ngClass",t.VKq(12,C,o.FormRecinado.get("nroot").touched&&o.FormRecinado.get("nroot").invalid)),t.xp6(2),t.Q6J("ngClass",t.VKq(14,C,o.FormRecinado.get("idestadoinspeccion").touched&&o.FormRecinado.get("idestadoinspeccion").invalid)),t.xp6(6),t.Q6J("ngModel",o.fch_reg_ot_rcc))},dependencies:[n.Pc,n.YG,n.W2,n.x4,n.Mj,n.Gu,n.gu,n.pK,n.Ie,n.rH,n.Ub,n.Q$,n.t9,n.n0,n.sr,n.d8,n.QI,n.j9,M.ez,M.mk,i.u5,i.JJ,i.UX,i.u]}),D})()}}]);