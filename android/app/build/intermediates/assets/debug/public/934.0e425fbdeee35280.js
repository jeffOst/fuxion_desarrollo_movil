"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[934],{934:(W,h,_)=>{_.r(h),_.d(h,{MttoWinOrdenTrabajo3Page:()=>v});var c=_(5861),m=_(6895),p=_(433),r=_(5562),T=_(1141),o=_(8256),b=_(1456),O=_(849),C=_(1407),P=_(7883);const M=["listenerOut"];function A(s,d){if(1&s){const t=o.EpF();o.TgZ(0,"ion-item-divider",11)(1,"ion-label"),o._uU(2,"\xa0"),o.TgZ(3,"strong"),o._uU(4),o.qZA()(),o.TgZ(5,"ion-chip",4),o.NdJ("click",function(){o.CHM(t);const n=o.oxw().$implicit,a=o.oxw();return o.KtG(a.agregarItem(n))}),o.TgZ(6,"ion-label"),o._uU(7,"Agregar"),o.qZA(),o._UZ(8,"ion-icon",5),o.qZA()()}if(2&s){const t=o.oxw().$implicit;o.xp6(4),o.Oqu(t.nomclase)}}function E(s,d){if(1&s){const t=o.EpF();o.TgZ(0,"ion-item",12)(1,"ion-button",13),o.NdJ("click",function(n){o.CHM(t);const a=o.oxw().$implicit,i=o.oxw();return o.KtG(i.FItemEliminar(n,a))}),o._uU(2," Quitar "),o._UZ(3,"ion-icon",14),o.qZA(),o.TgZ(4,"ion-toggle",15),o.NdJ("ionChange",function(n){o.CHM(t);const a=o.oxw().$implicit,i=o.oxw();return o.KtG(i.FasignaServicio(n,a))}),o.TgZ(5,"p",16)(6,"ion-badge",17),o._uU(7),o.qZA(),o.TgZ(8,"ion-text",18),o._uU(9),o.qZA(),o._uU(10," Cnt.Teorica: "),o.TgZ(11,"ion-text",19),o._uU(12),o.qZA()()(),o.TgZ(13,"ion-input",20),o.NdJ("ngModelChange",function(n){o.CHM(t);const a=o.oxw().$implicit;return o.KtG(a.otd_cantidad=n)})("ionBlur",function(n){o.CHM(t);const a=o.oxw().$implicit,i=o.oxw();return o.KtG(i.FBlourInput(n,a))}),o.qZA()()}if(2&s){const t=o.oxw().$implicit;o.xp6(4),o.Q6J("disabled","0"===t.habilitar_toggle)("checked","1"===t.check_toggle),o.xp6(2),o.s9C("color",t.color_atendido),o.xp6(1),o.Oqu(t.estado_abre),o.xp6(2),o.Oqu(t.nomclase),o.xp6(3),o.Oqu(t.otd_cantidad_plan),o.xp6(1),o.Q6J("disabled","0"===t.habilitar_input)("ngModel",t.otd_cantidad)}}function Z(s,d){if(1&s&&(o.TgZ(0,"ion-item-group"),o.YNc(1,A,9,1,"ion-item-divider",9),o.YNc(2,E,14,8,"ion-item",10),o.qZA()),2&s){const t=d.$implicit;o.xp6(1),o.Q6J("ngIf","1"===t.orden),o.xp6(1),o.Q6J("ngIf","2"===t.orden)}}let v=(()=>{class s{constructor(t,e,n,a,i,l,f,g,x,y,I){let u;this.navCtrl=t,this.loadingController=e,this.ApiService=n,this.storage=a,this.alertController=i,this.router=l,this.globalVal=f,this.ref=g,this.actionSheetCtrl=x,this.toastController=y,this.modalCtrl=I,this.DsServiciosxPieza={},this.ValuesAcordionGroup=["551571","551579"],this.storage.get("USER_INFO").then(D=>{u=D,this.NombresUsuarioLocal=u.user_name,this.IdUsuarioLocal=u.user_id,this.storage.get("DEVICE_INFO").then(U=>{u=U,this.NombreDispositivo=u.name,this.IdDispositivo=u.uuid})})}ngOnInit(){}ionViewWillEnter(){this.FLoadPiezasAcordion()}FLoadPiezasAcordion(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(e=>{e.present(),console.log(this.corre_inf_cab),this.ApiService.ListServiciosxBomba(this.globalVal.id_orden_trab_cab,this.IdUsuarioLocal).then(n=>{this.EditDataRest=n}).finally(()=>{this.loadingController.dismiss()})})}presentToast(t){var e=this;return(0,c.Z)(function*(){console.log("ingreso toast"),yield(yield e.toastController.create({message:t,duration:1500,position:"bottom"})).present()})()}FasignaServicio(t,e){var n=this;return(0,c.Z)(function*(){console.log(t),e.check_toggle=t.detail.checked?"1":"0",e.habilitar_input=t.detail.checked?"1":"0",yield n.ApiService.GuardarFormPaso2(e,n.IdUsuarioLocal).then(function(){var i=(0,c.Z)(function*(l){console.log(l),n.presentToast(l[0].o_msj)});return function(l){return i.apply(this,arguments)}}()).finally(()=>{}).catch(i=>{console.log("errror:::>>>>>>>>>",i)})})()}FBlourInput(t,e){var n=this;return(0,c.Z)(function*(){console.log(t),yield n.ApiService.GuardarFormPaso2(e,n.IdUsuarioLocal).then(function(){var i=(0,c.Z)(function*(l){console.log(l),n.presentToast(l[0].o_msj)});return function(l){return i.apply(this,arguments)}}()).finally(()=>{}).catch(i=>{console.log("errror:::>>>>>>>>>",i)}),t.preventDefault()})()}agregarItem(t){var e=this;return(0,c.Z)(function*(){console.log(t);const n=yield e.modalCtrl.create({component:T.MttoOtisPopUpAddItemPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:t}});return n.onDidDismiss().then(function(){var a=(0,c.Z)(function*(i){e.FLoadPiezasAcordion(),null!==i&&(e.dataReturned=i.data,console.log("Modal Sent Data :",e.dataReturned),"1"==i.data.o_nres||console.log("no guardo nada"))});return function(i){return a.apply(this,arguments)}}()),yield n.present()})()}agregarItemSinPieza(){this.agregarItem({idclase:0,nomclase:"Sin Pieza Definida",rs:"0",id_orden_trab_cab:this.globalVal.id_orden_trab_cab})}mostrarConfirmacion(){var t=this;return(0,c.Z)(function*(){yield(yield t.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea realizar esta acci\xf3n?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{t.SaveFormTerminadoPaso1()}}]})).present()})()}SaveFormTerminadoPaso1(){var t=this;return(0,c.Z)(function*(){t.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(n=>{n.present()}),yield t.ApiService.GuardarOtTerminado(t.globalVal.id_orden_trab_cab,t.IdUsuarioLocal).then(function(){var n=(0,c.Z)(function*(a){t.loadingController.dismiss(),console.log(a);let i="0"==a[0].o_nres?"alerta-error":"alerta-ok";yield(yield t.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:i,mode:"ios",animated:!0,message:a[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada"),"1"==a[0].o_nres&&t.navCtrl.navigateForward(["mtto-list-orden-trabajo"])}}]})).present()});return function(a){return n.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(n=>{console.log("errror:::>>>>>>>>>",n)})})()}FItemEliminar(t,e){var n=this;return(0,c.Z)(function*(){console.log(t,e),yield(yield n.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea quitar el item seleccionado?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{n.FQuitarItem(e)}}]})).present()})()}FQuitarItem(t){var e=this;return(0,c.Z)(function*(){e.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(i=>{i.present()});const a=[t];console.log('// Recorre el array y agrega la columna "idusuario" a cada objeto',t),a.forEach(i=>{i.IdUsuarioLocal=e.IdUsuarioLocal,i.acc=30}),console.log(a),yield e.ApiService.FQuitarItem(a[0]).then(function(){var i=(0,c.Z)(function*(l){if(e.loadingController.dismiss(),console.log(l),e.presentToast(l[0].o_msj),console.log(l[0].o_nres),"1"==l[0].o_nres){const g=e.EditDataRest.indexOf(t);g>-1&&e.EditDataRest.splice(g,1)}});return function(l){return i.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(i=>{console.log("errror:::>>>>>>>>>",i)})})()}}return s.\u0275fac=function(t){return new(t||s)(o.Y36(r.SH),o.Y36(r.HT),o.Y36(b.k),o.Y36(O.K),o.Y36(r.Br),o.Y36(C.F0),o.Y36(P.X),o.Y36(o.sBO),o.Y36(r.BX),o.Y36(r.yF),o.Y36(r.IN))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-mtto-win-orden-trabajo3"]],viewQuery:function(t,e){if(1&t&&o.Gf(M,7),2&t){let n;o.iGM(n=o.CRH())&&(e.listenerOut=n.first)}},standalone:!0,features:[o.jDz],decls:20,vars:2,consts:[["mode","ios"],["slot","start","color","primary",3,"click"],["name","refresh-outline"],["text-capitalize",""],["slot","end","mode","ios","color","primary",3,"click"],["name","add"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["fill","outline","expand","full","color","success",3,"disabled","click"],["button","true","class","divider",4,"ngIf"],["style","border-style: hidden",4,"ngIf"],["button","true",1,"divider"],[2,"border-style","hidden"],["color","danger","slot","start","no-padding","",2,"margin-inline-end","2px",3,"click"],["name","trash","slot","start"],["mode","ios","labelPlacement","start",2,"width","98%","border-style","hidden",3,"disabled","checked","ionChange"],[2,"font-size","small"],["slot","end",3,"color"],["color","primary"],["color","secondary"],["slot","end","type","number",2,"text-align","end","height","35px !important","width","15%","border-color","black","margin-inline-start","2px","border","1px",3,"disabled","ngModel","ngModelChange","ionBlur"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-chip",1),o.NdJ("click",function(){return e.FLoadPiezasAcordion()}),o._UZ(4,"ion-icon",2),o.TgZ(5,"ion-label"),o._uU(6,"Actualizar"),o.qZA()(),o.TgZ(7,"ion-title",3)(8,"ion-label"),o._uU(9,"SERVICIOS INTERNOS Y EXTERNOS "),o.qZA()(),o.TgZ(10,"ion-chip",4),o.NdJ("click",function(){return e.agregarItemSinPieza()}),o.TgZ(11,"ion-label"),o._uU(12,"Agregar"),o.qZA(),o._UZ(13,"ion-icon",5),o.qZA()()()(),o.TgZ(14,"ion-content",6)(15,"ion-list"),o.YNc(16,Z,3,2,"ion-item-group",7),o.qZA()(),o.TgZ(17,"ion-footer")(18,"ion-button",8),o.NdJ("click",function(){return e.mostrarConfirmacion()}),o._uU(19,"Terminado"),o.qZA()()),2&t&&(o.xp6(16),o.Q6J("ngForOf",e.EditDataRest),o.xp6(2),o.Q6J("disabled",e.globalVal.ot_estado_general>"2"))},dependencies:[r.Pc,r.yp,r.YG,r.hM,r.W2,r.fr,r.Gu,r.gu,r.pK,r.Ie,r.rH,r.Ub,r.Q$,r.q_,r.yW,r.wd,r.ho,r.sr,r.w,r.as,m.ez,m.sg,m.O5,p.u5,p.JJ,p.On],styles:[".divider[_ngcontent-%COMP%]{color:#000;font-weight:700;background-color:#d7d8da;padding:0!important;border-radius:5px;border-width:2px;font-weight:bolder}"]}),s})()}}]);