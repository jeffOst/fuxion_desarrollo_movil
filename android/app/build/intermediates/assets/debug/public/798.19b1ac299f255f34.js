"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[798],{5961:(I,b,l)=>{l.d(b,{GW:()=>g,dk:()=>f,oK:()=>m});var m=function(d){return d.Prompt="PROMPT",d.Camera="CAMERA",d.Photos="PHOTOS",d}(m||{}),g=function(d){return d.Rear="REAR",d.Front="FRONT",d}(g||{}),f=function(d){return d.Uri="uri",d.Base64="base64",d.DataUrl="dataUrl",d}(f||{})},8162:(I,b,l)=>{l.d(b,{V1:()=>f,dk:()=>g.dk,oK:()=>g.oK});var m=l(2726),g=l(5961);const f=(0,m.fo)("Camera",{web:()=>l.e(6468).then(l.bind(l,6468)).then(d=>new d.CameraWeb)})},5346:(I,b,l)=>{l.d(b,{ez:()=>g,tP:()=>m});var m=function(n){return n.Documents="DOCUMENTS",n.Data="DATA",n.Library="LIBRARY",n.Cache="CACHE",n.External="EXTERNAL",n.ExternalStorage="EXTERNAL_STORAGE",n}(m||{}),g=function(n){return n.UTF8="utf8",n.ASCII="ascii",n.UTF16="utf16",n}(g||{})},1461:(I,b,l)=>{l.d(b,{fy:()=>f,tP:()=>g.tP});var m=l(2726),g=l(5346);const f=(0,m.fo)("Filesystem",{web:()=>l.e(4522).then(l.bind(l,4522)).then(d=>new d.FilesystemWeb)})},4160:(I,b,l)=>{l.d(b,{J:()=>O});var m=l(5861),g=l(2519),f=l(6242),d=l(9862),n=l(2014);let O=(()=>{var A;class v{constructor(o,r){this.httpClient=o,this.storage=r,this.urlApiProd=g.N.UrlDomainLocal+"aw_modulos/mante/api/CApiInformeTecnico.php",this.urlApiInf=g.N.UrlDomainLocal+"aw_modulos/mante/api/CApiInformeTablero.php",this.confirmRequest=""}ListFindOts(o,r,c){let i=JSON.stringify({acc:1,s:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}SaveCheckListCab(o,r,c){let i=JSON.stringify({acc:2,id_orden_trab_cab:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}FormFindPaso1(o,r,c){let i=JSON.stringify({acc:3,idchecklistcab:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}FLoadPiezasAcordion(o,r,c){let i=JSON.stringify({acc:7,id:o,p2:r,cod_inf:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}FLoadServiciosxPiezas(o,r){let c=JSON.stringify({acc:8,id:o,p2:r});return this.httpClient.post(this.urlApiProd,c).toPromise().then(i=>i)}GuardarFormPaso1(o){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",o);let i=r.urlApiProd,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=4",a).toPromise()})()}GuardarinfPaso1(o){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",o);let i=r.urlApiInf,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=2",a).toPromise()})()}GuardarinfPaso2(o){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",o);let i=r.urlApiInf,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=3",a).toPromise()})()}GuardarinfPaso3(o){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",o);let i=r.urlApiInf,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=4",a).toPromise()})()}GuardarinfPaso4(o){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",o);let i=r.urlApiInf,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=5",a).toPromise()})()}GuardarinfPaso5(o){var r=this;return(0,m.Z)(function*(){let i=r.urlApiInf,a=JSON.stringify(o);return console.log("datos enviados",a),r.httpClient.post(i+"?acc=6",a).toPromise()})()}GuardarFormPaso2(o,r,c,i,a,p,C){var P=this;return(0,m.Z)(function*(){let e,u=P.urlApiProd,_=JSON.stringify({idservicio:o,idpapa:r,idhijo:c,idusuario:i,acc:9,idclase:a,ck:p,cod_material:C});return P.httpClient.post(u+"?acc=6",_).toPromise().then(h=>{console.log(h),e=h,P.confirmSaveBd=e[0].o_nres,P.confirmRequest=e},h=>{console.log(h,"Error- something is wrong!")})})()}FormFindPaso3(o,r,c){let i=JSON.stringify({acc:7,idchecklistcab:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}GuardarFormPaso3(o){var r=this;return(0,m.Z)(function*(){let c,i=r.urlApiProd,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=8",a).toPromise().then(p=>{console.log(p),c=p,r.confirmSaveBd=c[0].o_nres,r.confirmRequest=c},p=>{console.log(p,"Error- something is wrong!")})})()}FormFindPaso5(o,r,c){let i=JSON.stringify({acc:10,id:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}GuardarFormPaso5(o){var r=this;return(0,m.Z)(function*(){let i=r.urlApiProd,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=11",a).toPromise()})()}FormFindPaso6(o,r,c){let i=JSON.stringify({acc:12,idchecklistcab:o,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(a=>a)}GuardarFormPaso6(o){var r=this;return(0,m.Z)(function*(){let i=r.urlApiProd,a=JSON.stringify(o);return r.httpClient.post(i+"?acc=13",a).toPromise()})()}GuardarAplicaPaso(o,r,c){var i=this;return(0,m.Z)(function*(){let a,C,p=i.urlApiProd;C={idchecklistcab:o,numeroPaso:r,ck:c};let P=JSON.stringify(C);return i.httpClient.post(p+"?acc=15",P).toPromise().then(e=>{console.log(e),a=e,i.confirmSaveBd=a[0].o_nres,i.confirmRequest=a},e=>{console.log(e,"Error- something is wrong!")})})()}getImages(o){return this.httpClient.get(`${this.urlApiProd}?acc=5&id=`+o)}uploadImage(o,r,c){let i=new FormData;return i.append("file",o,"myimage."+c),i.append("id",r),i.append("acc","6"),i.append("type","image/png"),this.httpClient.post(this.urlApiProd,i)}UpLoadImageMultiple(o,r,c){try{let i=new FormData;i.append("id",r),i.append("acc","15"),i.append("type","image/png");for(let a=0;a<o.length;a++)console.log("image::ruta=>::>",o[a]),i.append("images[]",o[a],`image_${a}.jpg`);return this.httpClient.post(this.urlApiProd,i)}catch(i){console.error("Error al enviar im\xe1genes al API:",i)}}LoadPdfInformeTecnico(o){let r=JSON.stringify({acc:14,idchecklistcab:o});return this.httpClient.post(this.urlApiProd,r).toPromise().then(c=>c)}deleteImage(o){return this.httpClient.delete(`${this.urlApiProd}?acc=16&id=${o}`)}}return(A=v).\u0275fac=function(o){return new(o||A)(f.LFG(d.eN),f.LFG(n.K))},A.\u0275prov=f.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),v})()},2087:(I,b,l)=>{function f(){const d=new FileReader;return d.__zone_symbol__originalInstance||d}l.d(b,{y3:()=>f})},798:(I,b,l)=>{l.r(b),l.d(b,{MttoWinInformeTablero4Page:()=>a});var m=l(5861),g=l(6814),f=l(2519),d=l(95),n=l(6728),O=l(1461),A=l(2087),v=l(8162),t=l(6242),o=l(1991),r=l(6172),c=l(4160);function i(p,C){if(1&p){const P=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",22),t._UZ(2,"ion-img",23),t.qZA(),t._UZ(3,"ion-img",23),t.TgZ(4,"ion-label"),t._uU(5),t.qZA(),t.TgZ(6,"ion-button",24),t.NdJ("click",function(){const s=t.CHM(P),u=s.$implicit,_=s.index,h=t.oxw();return t.KtG(h.deleteImage(u.idadjunto,_))}),t._UZ(7,"ion-icon",25),t.qZA()()}if(2&p){const P=C.$implicit,e=t.oxw();t.xp6(2),t.Q6J("src",e.DirectorioFotos+P.idnomadjunto),t.xp6(1),t.Q6J("src",P.webviewPath),t.xp6(2),t.Oqu(P.name)}}let a=(()=>{var p;class C{constructor(e,s,u,_,h,E,F,B){this.formBuilder=e,this.alertController=s,this.loadingController=u,this.ApiService1=_,this.ref=h,this.actionSheetCtrl=E,this.globalVal=F,this.ApiService=B,this.imgs=[],this.imageBlobs=[],this.images=[],this.DirectorioFotos=f.N.UrlDomainLocal+"aw_file/adjuntos/",this.checklist_paso1_apli_ck=!1,this.convertBlobToBase64=M=>new Promise((G,R)=>{this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(D=>{D.present()}),new FileReader;let Z=(0,A.y3)();Z.readAsDataURL(M),Z.onload=D=>{let T;T=D.target.result,T=this.dataURLtoBlob(T),this.ApiService.uploadImage(T,this.globalVal.corre_inf_cab,"png").subscribe(y=>{this.loadingController.dismiss(),this.loadImages(this.globalVal.corre_inf_cab),console.log("salio okkkk::",y)},y=>{console.log("error__::>",y)})}}).finally(()=>{console.log("convertBlobToBase64:::",this.convertBlobToBase64)}),this.FormCheckListPaso4=this.formBuilder.group({manioper:[""],estgab:[""],basesopt:[""],analisis:[""],obser3:[""],corre_inf_cab:[""],estado_informe:[""]})}ionViewWillEnter(){let e;this.checklist_paso1_apli_ck="0"==this.globalVal.checklist_paso1_apli,this.FLoadForms(),e={detail:{checked:this.checklist_paso1_apli_ck,jc:0}}}FLoadForms(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(s=>{s.present(),this.ApiService1.FormFindinftab1(this.globalVal.corre_inf_cab).then(u=>{console.log(this.globalVal.corre_inf_cab),this.EditDataRest1=u.list;try{this.FormCheckListPaso4.setValue({corre_inf_cab:this.globalVal.corre_inf_cab,manioper:this.EditDataRest1[0].manioper,estgab:this.EditDataRest1[0].estgab,basesopt:this.EditDataRest1[0].basesopt,analisis:this.EditDataRest1[0].analisis,obser3:this.EditDataRest1[0].obser3,estado_informe:""}),this.loadImages(this.globalVal.corre_inf_cab)}catch(_){console.log("error:::>",_)}}).finally(()=>{this.loadingController.dismiss()})})}SaveFormInfPaso1(){var e=this;this.alertSiNo=this.alertController.create({header:"INFORME TECNICO",subHeader:"DATOS GENERALES",mode:"ios",backdropDismiss:!0,cssClass:"alerta-ok",message:"Confirmar que desea guardar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(s=>{s.present(),s.onDidDismiss().then(u=>{"A"==u.role&&(this.loadingController.create({message:"Guardando datos generales...",translucent:!0}).then(h=>{h.present()}),this.FormCheckListPaso4.controls.corre_inf_cab.setValue(this.globalVal.corre_inf_cab),this.ApiService.GuardarinfPaso4(this.FormCheckListPaso4.value).then(function(){var h=(0,m.Z)(function*(E){e.loadingController.dismiss();let F="0"==E[0].o_nres?"alerta-error":"alerta-ok";yield(yield e.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"DATOS GENERALES",cssClass:F,mode:"ios",animated:!0,message:E[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada")}}]})).present()});return function(E){return h.apply(this,arguments)}}()).finally(()=>{}).catch(h=>{console.log("errror:::>>>>>>>>>",h)}))})})}selectImageSource(){var e=this;return(0,m.Z)(function*(){const s=[{text:"Tome una Foto",icon:"camera",handler:()=>{console.log(v.oK.Camera),e.addNewToGallery(1)}},{text:"Elegir desde las fotos",icon:"image",handler:()=>{console.log("Photos",v.oK.Photos),e.pickImages_buton()}}];yield(yield e.actionSheetCtrl.create({header:"Selecionar Image",buttons:s})).present()})()}pickImages_buton(){var e=this;return(0,m.Z)(function*(){const s={width:800,height:800,quality:100,correctOrientation:!0};try{const _=(yield v.V1.pickImages(s)).photos;e.imgs=[],e.imageBlobs=[];for(let h=0;h<_.length;h++)e.imgs.push(_[h].webPath);e.sendImages()}catch(u){console.error("Error picking images",u)}})()}sendImages(){this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(e=>{e.present()}),Promise.all(this.imgs.map(e=>this.convertAndAddToBlobs(e))).then(()=>{this.ApiService.UpLoadImageMultiple(this.imageBlobs,this.globalVal.corre_inf_cab,"png").subscribe(s=>{this.loadingController.dismiss(),this.loadImages(this.globalVal.corre_inf_cab),console.log("salio okkkk::",s)},s=>{console.log("error__::>",s)})}).catch(e=>{console.error("Error converting and adding Blobs",e)})}loadImages(e){this.ApiService.getImages(e).subscribe(s=>{this.images=s,this.ref.detectChanges()})}convertAndAddToBlobs(e){var s=this;return(0,m.Z)(function*(){try{console.log("convertAndAddToBlobs",e);const u=yield s.getBlobFromImagePath(e);s.addImageBlob(u)}catch(u){console.error("Error converting image to Blob",u)}})()}addImageBlob(e){this.imageBlobs.push(e)}getBlobFromImagePath(e){return(0,m.Z)(function*(){return yield(yield fetch(e)).blob()})()}addNewToGallery(e){var s=this;return(0,m.Z)(function*(){let u;console.log("addNewToGallery::::tp::::>",e),1==e&&(u=yield v.V1.getPhoto({resultType:v.dk.Uri,source:v.oK.Camera,quality:100,width:800,height:800}).finally(()=>{console.log("capturedPhoto::::",u)})),yield s.savePicture(u)})()}savePicture(e){var s=this;return(0,m.Z)(function*(){const u=yield s.readAsBase64(e),_=(new Date).getTime()+".jpeg";return yield O.fy.writeFile({path:_,data:u,directory:O.tP.Data}),{filepath:_,webviewPath:e.webPath}})()}readAsBase64(e){var s=this;return(0,m.Z)(function*(){const _=yield(yield fetch(e.webPath)).blob();return yield s.convertBlobToBase64(_)})()}dataURLtoBlob(e){console.log("dentro fucion dataURLtoBlob:",e);for(var s=e.split(","),u=s[0].match(/:(.*?);/)[1],_=atob(s[1]),h=_.length,E=new Uint8Array(h);h--;)E[h]=_.charCodeAt(h);return new Blob([E],{type:u})}ngOnInit(){}deleteImage(e,s){this.alertSiNo=this.alertController.create({header:"INFORME TECNICO",subHeader:"GENERAL",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea eliminar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(u=>{u.present(),u.onDidDismiss().then(_=>{console.log("aceptaPop::::>>",_),"A"==_.role&&this.ApiService.deleteImage(e).subscribe(h=>{this.images.splice(s,1)})})})}}return(p=C).\u0275fac=function(e){return new(e||p)(t.Y36(d.QS),t.Y36(n.Br),t.Y36(n.HT),t.Y36(o.k),t.Y36(t.sBO),t.Y36(n.BX),t.Y36(r.X),t.Y36(c.J))},p.\u0275cmp=t.Xpm({type:p,selectors:[["app-mtto-win-informe-tablero4"]],standalone:!0,features:[t.jDz],decls:53,vars:18,consts:[["mode","ios"],["text-capitalize",""],[3,"formGroup"],["mode","ios",1,"ion-no-padding"],["position","floating"],["mode","ios","formControlName","manioper",3,"autoGrow","autofocus"],["mode","ios","formControlName","estgab",3,"autoGrow","autofocus"],["mode","ios","formControlName","basesopt",3,"autoGrow","autofocus"],["color","danger"],["mode","ios","formControlName","analisis",3,"autoGrow","autofocus"],["mode","ios","formControlName","obser3",3,"autoGrow","autofocus"],["expand","block"],["slot","end",3,"click"],["name","camera"],[4,"ngFor","ngForOf"],[2,"text-align","center"],["mode","ios","formControlName","estado_informe",1,"ion_segment_3d",2,"width","110%"],["value","1","layout","icon-end",3,"click"],["name","close","color","danger"],["value","2","layout","icon-end",3,"click"],["color","success","name","checkmark"],["color","success"],["slot","start"],[3,"src"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-title",1)(4,"ion-label"),t._uU(5,"PARTE MECANICA"),t.qZA()()()()(),t.TgZ(6,"ion-content")(7,"form",2)(8,"ion-list",3)(9,"ion-item")(10,"ion-label",4),t._uU(11," Manija de operaci\xf3n: "),t.qZA(),t._UZ(12,"ion-textarea",5),t.qZA(),t.TgZ(13,"ion-item")(14,"ion-label",4),t._uU(15," Estado de gabinete (Orejas, seguros, bisagras,puntos de conexi\xf3n) "),t.qZA(),t._UZ(16,"ion-textarea",6),t.qZA(),t.TgZ(17,"ion-item")(18,"ion-label",4),t._uU(19," Base soporte de tablero el\xe9ctrico: "),t.qZA(),t._UZ(20,"ion-textarea",7),t.qZA(),t.TgZ(21,"ion-item-group")(22,"ion-item-divider",8)(23,"ion-label"),t._uU(24,"Analisis de Falla"),t.qZA()(),t.TgZ(25,"ion-item"),t._UZ(26,"ion-textarea",9),t.qZA(),t.TgZ(27,"ion-item")(28,"ion-label",4),t._uU(29," Otros: "),t.qZA(),t._UZ(30,"ion-textarea",10),t.qZA()(),t.TgZ(31,"ion-item",11),t._uU(32,"Fotos: "),t.TgZ(33,"ion-fab-button",12),t.NdJ("click",function(){return s.selectImageSource()}),t._UZ(34,"ion-icon",13),t.qZA()(),t.TgZ(35,"ion-list"),t.YNc(36,i,8,3,"ion-item",14),t.qZA()()()(),t.TgZ(37,"ion-footer")(38,"form",2)(39,"ion-grid")(40,"ion-row"),t._UZ(41,"ion-col"),t.TgZ(42,"ion-col",15)(43,"ion-segment",16)(44,"ion-segment-button",17),t.NdJ("click",function(){return s.SaveFormInfPaso1()}),t._UZ(45,"ion-icon",18),t.TgZ(46,"ion-label",8),t._uU(47,"BORRADOR"),t.qZA()(),t.TgZ(48,"ion-segment-button",19),t.NdJ("click",function(){return s.SaveFormInfPaso1()}),t._UZ(49,"ion-icon",20),t.TgZ(50,"ion-label",21),t._uU(51,"TERMINADO"),t.qZA()()()(),t._UZ(52,"ion-col"),t.qZA()()()()),2&e&&(t.xp6(7),t.Q6J("formGroup",s.FormCheckListPaso4),t.xp6(5),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(6),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(6),t.Q6J("ngForOf",s.images),t.xp6(2),t.Q6J("formGroup",s.FormCheckListPaso4))},dependencies:[n.Pc,n.YG,n.wI,n.W2,n.W4,n.fr,n.jY,n.Gu,n.gu,n.Xz,n.Ie,n.rH,n.Ub,n.Q$,n.q_,n.Nd,n.cJ,n.GO,n.g2,n.Bs,n.wd,n.sr,n.QI,n.j9,g.ez,g.sg,d.u5,d._Y,d.JJ,d.JL,d.UX,d.sg,d.u]}),C})()}}]);