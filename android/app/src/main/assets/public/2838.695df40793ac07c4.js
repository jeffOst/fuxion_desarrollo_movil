"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2838],{2838:(j,h,d)=>{d.r(h),d.d(h,{MttoWinOrdenTrabajo2Page:()=>D});var s=d(5861),m=d(6895),p=d(433),r=d(5562),b=d(1141),T=d(8534),t=d(8256),P=d(1456),A=d(849),C=d(1407),O=d(7883);const Z=["listenerOut"];function E(c,_){if(1&c){const e=t.EpF();t.TgZ(0,"ion-item-divider",17)(1,"ion-label"),t._uU(2,"\xa0"),t.TgZ(3,"strong"),t._uU(4),t.qZA()(),t.TgZ(5,"ion-chip",10),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,i=t.oxw();return t.KtG(i.agregarItem(n))}),t.TgZ(6,"ion-label"),t._uU(7,"Agregar"),t.qZA(),t._UZ(8,"ion-icon",11),t.qZA()()}if(2&c){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(e.nomclase)}}function M(c,_){if(1&c){const e=t.EpF();t.TgZ(0,"ion-item",18)(1,"ion-badge",19),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",20),t.NdJ("click",function(n){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.FItemEliminar(n,i))}),t._uU(4," Quitar "),t._UZ(5,"ion-icon",21),t.qZA(),t.TgZ(6,"ion-toggle",22),t.NdJ("ionChange",function(n){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.FasignaServicio(n,i))}),t.TgZ(7,"p",23)(8,"ion-badge",24),t._uU(9),t.qZA(),t.TgZ(10,"ion-text",25),t._uU(11),t.qZA(),t._uU(12," Cnt.Teorica: "),t.TgZ(13,"ion-text",26),t._uU(14),t.qZA()()(),t.TgZ(15,"ion-input",27),t.NdJ("ngModelChange",function(n){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.otd_cantidad=n)})("ionBlur",function(n){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw();return t.KtG(a.FBlourInput(n,i))}),t.qZA()()}if(2&c){const e=t.oxw().$implicit;t.xp6(2),t.hij("",e.orden1,".-"),t.xp6(4),t.Q6J("disabled","0"===e.habilitar_toggle)("checked","1"===e.check_toggle),t.xp6(2),t.s9C("color",e.color_atendido),t.xp6(1),t.Oqu(e.estado_abre),t.xp6(2),t.Oqu(e.nomclase),t.xp6(3),t.Oqu(e.otd_cantidad_plan),t.xp6(1),t.Q6J("disabled","0"===e.habilitar_input)("ngModel",e.otd_cantidad)}}function y(c,_){if(1&c&&(t.TgZ(0,"ion-item-group"),t.YNc(1,E,9,1,"ion-item-divider",15),t.YNc(2,M,16,9,"ion-item",16),t.qZA()),2&c){const e=_.$implicit;t.xp6(1),t.Q6J("ngIf","1"===e.orden),t.xp6(1),t.Q6J("ngIf","2"===e.orden)}}let D=(()=>{class c{constructor(e,o,n,i,a,l,f,g,v,x,I){let u;this.navCtrl=e,this.loadingController=o,this.ApiService=n,this.storage=i,this.alertController=a,this.router=l,this.globalVal=f,this.ref=g,this.actionSheetCtrl=v,this.toastController=x,this.modalCtrl=I,this.DsServiciosxPieza={},this.ValuesAcordionGroup=["551571","551579"],this.itemsAcum=0,this.disabledBusquedaPartList=!0,this.storage.get("USER_INFO").then(U=>{u=U,this.NombresUsuarioLocal=u.user_name,this.IdUsuarioLocal=u.user_id,this.storage.get("DEVICE_INFO").then(L=>{u=L,this.NombreDispositivo=u.name,this.IdDispositivo=u.uuid})}),this.disabledBusquedaPartList="R"!==this.globalVal.fab_rep}ngAfterViewInit(){this.itemsAcum=0}ngOnInit(){this.itemsAcum=0}get autoIncrement(){let e=0;for(const o of this.EditDataRest)"1"===o.item&&(e+=1);return e}ionViewWillEnter(){this.itemsAcum=0,this.FLoadPiezasAcordion()}FLoadPiezasAcordion(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(o=>{o.present(),this.ApiService.ListRepuestosxBomba(this.globalVal.id_orden_trab_cab,this.IdUsuarioLocal).then(n=>{let i=0;this.itemsAcum=0,this.EditDataRest=n,console.log(this.EditDataRest),this.EditDataRest.forEach(a=>{"1"===a.item&&(this.itemsAcum++,this.EditDataRest[i].orden1=this.itemsAcum,this.mttoNombrePartList=this.EditDataRest[i].nombre_partlist_otc),i++})}).finally(()=>{this.loadingController.dismiss()})})}presentToast(e){var o=this;return(0,s.Z)(function*(){console.log("ingreso toast"),yield(yield o.toastController.create({message:e,duration:1500,position:"bottom"})).present()})()}FasignaServicio(e,o){var n=this;return(0,s.Z)(function*(){console.log(e),o.check_toggle=e.detail.checked?"1":"0",o.habilitar_input=e.detail.checked?"1":"0",yield n.ApiService.GuardarFormPaso2(o,n.IdUsuarioLocal).then(function(){var a=(0,s.Z)(function*(l){console.log(l),n.presentToast(l[0].o_msj),"1"==l[0].o_nres&&(o.otd_cantidad=o.otd_cantidad_plan)});return function(l){return a.apply(this,arguments)}}()).finally(()=>{}).catch(a=>{console.log("errror:::>>>>>>>>>",a)})})()}FBlourInput(e,o){var n=this;return(0,s.Z)(function*(){console.log(e),yield n.ApiService.GuardarFormPaso2(o,n.IdUsuarioLocal).then(function(){var a=(0,s.Z)(function*(l){console.log(l),n.presentToast(l[0].o_msj)});return function(l){return a.apply(this,arguments)}}()).finally(()=>{}).catch(a=>{console.log("errror:::>>>>>>>>>",a)}),e.preventDefault()})()}agregarItem(e){var o=this;return(0,s.Z)(function*(){console.log(e);const n=yield o.modalCtrl.create({component:b.MttoOtisPopUpAddItemPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:e}});return n.onDidDismiss().then(function(){var i=(0,s.Z)(function*(a){o.FLoadPiezasAcordion(),null!==a&&(o.dataReturned=a.data,console.log("Modal Sent Data :",o.dataReturned),"1"==a.data.o_nres||console.log("no guardo nada"))});return function(a){return i.apply(this,arguments)}}()),yield n.present()})()}agregarItemSinPieza(){this.agregarItem({idclase:0,nomclase:"Sin Pieza Definida",rs:"1",id_orden_trab_cab:this.globalVal.id_orden_trab_cab})}mostrarConfirmacion(){var e=this;return(0,s.Z)(function*(){yield(yield e.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea realizar esta acci\xf3n?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{e.SaveFormTerminadoPaso1()}}]})).present()})()}SaveFormTerminadoPaso1(){var e=this;return(0,s.Z)(function*(){e.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(n=>{n.present()}),yield e.ApiService.GuardarOtTerminado(e.globalVal.id_orden_trab_cab,e.IdUsuarioLocal).then(function(){var n=(0,s.Z)(function*(i){e.loadingController.dismiss(),console.log(i);let a="0"==i[0].o_nres?"alerta-error":"alerta-ok";yield(yield e.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:a,mode:"ios",animated:!0,message:i[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada"),"1"==i[0].o_nres&&e.navCtrl.navigateForward(["mtto-list-orden-trabajo"])}}]})).present()});return function(i){return n.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(n=>{console.log("errror:::>>>>>>>>>",n)})})()}FItemEliminar(e,o){var n=this;return(0,s.Z)(function*(){console.log(e,o),yield(yield n.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea quitar el item seleccionado?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{n.FQuitarItem(o)}}]})).present()})()}FQuitarItem(e){var o=this;return(0,s.Z)(function*(){o.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(a=>{a.present()});const i=[e];console.log('// Recorre el array y agrega la columna "idusuario" a cada objeto',e),i.forEach(a=>{a.IdUsuarioLocal=o.IdUsuarioLocal,a.acc=30}),console.log(i),yield o.ApiService.FQuitarItem(i[0]).then(function(){var a=(0,s.Z)(function*(l){if(o.loadingController.dismiss(),console.log(l),o.presentToast(l[0].o_msj),console.log(l[0].o_nres),"1"==l[0].o_nres){const g=o.EditDataRest.indexOf(e);g>-1&&o.EditDataRest.splice(g,1)}});return function(l){return a.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(a=>{console.log("errror:::>>>>>>>>>",a)})})()}cambiarPartList(){var e=this;return(0,s.Z)(function*(){let o={IdUsuarioLocal:e.IdUsuarioLocal,id_orden_trab_cab:e.globalVal.id_orden_trab_cab};const n=yield e.modalCtrl.create({component:T.MttoOtisPopUpAddPartListPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:o}});return n.onDidDismiss().then(function(){var i=(0,s.Z)(function*(a){e.FLoadPiezasAcordion(),null!==a&&(e.dataReturned=a.data,console.log("Modal Sent Data :",e.dataReturned),e.mttoNombrePartList=a.data.tipofuente,e.globalVal.nombre_partlist_otc=a.data.configuracion,"1"==a.data.o_nres||console.log("no guardo nada"))});return function(a){return i.apply(this,arguments)}}()),yield n.present()})()}mostrarConfirmacion_detalle(){var e=this;return(0,s.Z)(function*(){console.log("EditDataRest::",e.EditDataRest),console.log("count::>",e.EditDataRest.length),e.EditDataRest.length>0?yield(yield e.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea cargar detalle, se perdera algun cambio previo en el detalle de los items que no esten aprobados?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{e.SavePartList()}}]})).present():e.SavePartList()})()}SavePartList(){var e=this;return(0,s.Z)(function*(){e.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(n=>{n.present()}),yield e.ApiService.GuardarCargarDetalleOT(e.globalVal.id_orden_trab_cab,e.IdUsuarioLocal).then(function(){var n=(0,s.Z)(function*(i){e.loadingController.dismiss(),console.log(i);let a="0"==i[0].o_nres?"alerta-error":"alerta-ok";yield(yield e.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:a,mode:"ios",animated:!0,message:i[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{"1"==i[0].o_nres&&e.FLoadPiezasAcordion()}}]})).present()});return function(i){return n.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(n=>{console.log("errror:::>>>>>>>>>",n)})})()}}return c.\u0275fac=function(e){return new(e||c)(t.Y36(r.SH),t.Y36(r.HT),t.Y36(P.k),t.Y36(A.K),t.Y36(r.Br),t.Y36(C.F0),t.Y36(O.X),t.Y36(t.sBO),t.Y36(r.BX),t.Y36(r.yF),t.Y36(r.IN))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-mtto-win-orden-trabajo2"]],viewQuery:function(e,o){if(1&e&&t.Gf(Z,7),2&e){let n;t.iGM(n=t.CRH())&&(o.listenerOut=n.first)}},standalone:!0,features:[t.jDz],decls:28,vars:5,consts:[["mode","ios"],["slot","start"],["color","success",3,"ngModel"],["slot","end",3,"disabled","click"],["name","search","slot","end"],[2,"padding","0px","border","0px"],["slot","end","color","primary",3,"outline","click"],["name","create"],["slot","end","color","primary",3,"click"],["name","refresh-outline"],["slot","end","mode","ios","color","primary",3,"click"],["name","add"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["expand","full","color","primary",3,"disabled","click"],["button","true","class","divider",4,"ngIf"],["style","border-style: hidden",4,"ngIf"],["button","true",1,"divider"],[2,"border-style","hidden"],["slot","start","color","medium","no-padding",""],["color","danger","slot","start","no-padding","",2,"margin-inline-end","2px",3,"click"],["name","trash","slot","start"],["mode","ios","labelPlacement","start",2,"width","98%","border-style","hidden",3,"disabled","checked","ionChange"],[2,"font-size","small","width","100%"],["slot","end","no-padding","",3,"color"],["color","primary"],["color","secondary"],["slot","end","type","number",2,"text-align","end","height","35px !important","width","13%","border-color","black","margin-inline-start","2px","border","1px",3,"disabled","ngModel","ngModelChange","ionBlur"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-note",1),t._uU(4,"PartList:"),t.qZA(),t._UZ(5,"ion-input",2),t.TgZ(6,"ion-button",3),t.NdJ("click",function(){return o.cambiarPartList()}),t._UZ(7,"ion-icon",4),t._uU(8," Buscar "),t.qZA()(),t.TgZ(9,"ion-item",5)(10,"ion-chip",6),t.NdJ("click",function(){return o.mostrarConfirmacion_detalle()}),t._UZ(11,"ion-icon",7),t.TgZ(12,"ion-label"),t._uU(13,"Cargar Detalle"),t.qZA()(),t.TgZ(14,"ion-chip",8),t.NdJ("click",function(){return o.FLoadPiezasAcordion()}),t._UZ(15,"ion-icon",9),t.TgZ(16,"ion-label"),t._uU(17,"Actualizar"),t.qZA()(),t.TgZ(18,"ion-chip",10),t.NdJ("click",function(){return o.agregarItemSinPieza()}),t.TgZ(19,"ion-label"),t._uU(20,"Agregar"),t.qZA(),t._UZ(21,"ion-icon",11),t.qZA()()()(),t.TgZ(22,"ion-content",12)(23,"ion-list"),t.YNc(24,y,3,2,"ion-item-group",13),t.qZA()(),t.TgZ(25,"ion-footer")(26,"ion-button",14),t.NdJ("click",function(){return o.mostrarConfirmacion()}),t._uU(27,"Terminado"),t.qZA()()),2&e&&(t.xp6(5),t.Q6J("ngModel",o.mttoNombrePartList),t.xp6(1),t.Q6J("disabled",o.disabledBusquedaPartList),t.xp6(4),t.Q6J("outline",!0),t.xp6(14),t.Q6J("ngForOf",o.EditDataRest),t.xp6(2),t.Q6J("disabled",o.globalVal.ot_estado_general>"2"))},dependencies:[r.Pc,r.yp,r.YG,r.hM,r.W2,r.fr,r.Gu,r.gu,r.pK,r.Ie,r.rH,r.Ub,r.Q$,r.q_,r.uN,r.yW,r.ho,r.sr,r.w,r.as,r.j9,m.ez,m.sg,m.O5,p.u5,p.JJ,p.On],styles:[".divider[_ngcontent-%COMP%]{color:#000;font-weight:700;background-color:#d7d8da;padding:0!important;border-radius:5px;border-width:2px;font-weight:bolder}"]}),c})()}}]);