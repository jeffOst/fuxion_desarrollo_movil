"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[798],{5961:(I,P,l)=>{l.d(P,{GW:()=>g,dk:()=>f,oK:()=>m});var m=function(d){return d.Prompt="PROMPT",d.Camera="CAMERA",d.Photos="PHOTOS",d}(m||{}),g=function(d){return d.Rear="REAR",d.Front="FRONT",d}(g||{}),f=function(d){return d.Uri="uri",d.Base64="base64",d.DataUrl="dataUrl",d}(f||{})},8162:(I,P,l)=>{l.d(P,{V1:()=>f,dk:()=>g.dk,oK:()=>g.oK});var m=l(2726),g=l(5961);const f=(0,m.fo)("Camera",{web:()=>l.e(6468).then(l.bind(l,6468)).then(d=>new d.CameraWeb)})},5346:(I,P,l)=>{l.d(P,{ez:()=>g,tP:()=>m});var m=function(a){return a.Documents="DOCUMENTS",a.Data="DATA",a.Library="LIBRARY",a.Cache="CACHE",a.External="EXTERNAL",a.ExternalStorage="EXTERNAL_STORAGE",a}(m||{}),g=function(a){return a.UTF8="utf8",a.ASCII="ascii",a.UTF16="utf16",a}(g||{})},1461:(I,P,l)=>{l.d(P,{fy:()=>f,tP:()=>g.tP});var m=l(2726),g=l(5346);const f=(0,m.fo)("Filesystem",{web:()=>l.e(4522).then(l.bind(l,4522)).then(d=>new d.FilesystemWeb)})},4160:(I,P,l)=>{l.d(P,{J:()=>O});var m=l(5861),g=l(2519),f=l(6242),d=l(9862),a=l(2014);let O=(()=>{var v;class C{constructor(e,r){this.httpClient=e,this.storage=r,this.urlApiProd=g.N.UrlDomainLocal+"aw_modulos/mante/api/CApiInformeTecnico.php",this.urlApiInf=g.N.UrlDomainLocal+"aw_modulos/mante/api/CApiInformeTablero.php",this.confirmRequest=""}ListFindOts(e,r,c){let i=JSON.stringify({acc:1,s:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}SaveCheckListCab(e,r,c){let i=JSON.stringify({acc:2,id_orden_trab_cab:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}FormFindPaso1(e,r,c){let i=JSON.stringify({acc:3,idchecklistcab:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}FLoadPiezasAcordion(e,r){let c=JSON.stringify({acc:7,id:e,p2:r});return this.httpClient.post(this.urlApiProd,c).toPromise().then(i=>i)}FLoadServiciosxPiezas(e,r){let c=JSON.stringify({acc:8,id:e,p2:r});return this.httpClient.post(this.urlApiProd,c).toPromise().then(i=>i)}GuardarFormPaso1(e){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",e);let i=r.urlApiProd,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=4",n).toPromise()})()}GuardarinfPaso1(e){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",e);let i=r.urlApiInf,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=2",n).toPromise()})()}GuardarinfPaso2(e){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",e);let i=r.urlApiInf,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=3",n).toPromise()})()}GuardarinfPaso3(e){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",e);let i=r.urlApiInf,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=4",n).toPromise()})()}GuardarinfPaso4(e){var r=this;return(0,m.Z)(function*(){console.log("Dentro::GuardarFormulario::>",e);let i=r.urlApiInf,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=5",n).toPromise()})()}GuardarinfPaso5(e){var r=this;return(0,m.Z)(function*(){let i=r.urlApiInf,n=JSON.stringify(e);return console.log("datos enviados",n),r.httpClient.post(i+"?acc=6",n).toPromise()})()}GuardarFormPaso2(e,r,c,i,n,p){var A=this;return(0,m.Z)(function*(){let b,s=A.urlApiProd,u=JSON.stringify({idservicio:e,idpapa:r,idhijo:c,idusuario:i,acc:9,idclase:n,ck:p});return A.httpClient.post(s+"?acc=6",u).toPromise().then(h=>{console.log(h),b=h,A.confirmSaveBd=b[0].o_nres,A.confirmRequest=b},h=>{console.log(h,"Error- something is wrong!")})})()}FormFindPaso3(e,r,c){let i=JSON.stringify({acc:7,idchecklistcab:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}GuardarFormPaso3(e){var r=this;return(0,m.Z)(function*(){let c,i=r.urlApiProd,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=8",n).toPromise().then(p=>{console.log(p),c=p,r.confirmSaveBd=c[0].o_nres,r.confirmRequest=c},p=>{console.log(p,"Error- something is wrong!")})})()}FormFindPaso5(e,r,c){let i=JSON.stringify({acc:10,id:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}GuardarFormPaso5(e){var r=this;return(0,m.Z)(function*(){let i=r.urlApiProd,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=11",n).toPromise()})()}FormFindPaso6(e,r,c){let i=JSON.stringify({acc:12,idchecklistcab:e,idusu:r,iddevice:c});return this.httpClient.post(this.urlApiProd,i).toPromise().then(n=>n)}GuardarFormPaso6(e){var r=this;return(0,m.Z)(function*(){let i=r.urlApiProd,n=JSON.stringify(e);return r.httpClient.post(i+"?acc=13",n).toPromise()})()}GuardarAplicaPaso(e,r,c){var i=this;return(0,m.Z)(function*(){let n,A,p=i.urlApiProd;A={idchecklistcab:e,numeroPaso:r,ck:c};let b=JSON.stringify(A);return i.httpClient.post(p+"?acc=15",b).toPromise().then(o=>{console.log(o),n=o,i.confirmSaveBd=n[0].o_nres,i.confirmRequest=n},o=>{console.log(o,"Error- something is wrong!")})})()}getImages(e){return this.httpClient.get(`${this.urlApiProd}?acc=5&id=`+e)}uploadImage(e,r,c){let i=new FormData;return i.append("file",e,"myimage."+c),i.append("id",r),i.append("acc","6"),i.append("type","image/png"),this.httpClient.post(this.urlApiProd,i)}UpLoadImageMultiple(e,r,c){try{let i=new FormData;i.append("id",r),i.append("acc","15"),i.append("type","image/png");for(let n=0;n<e.length;n++)console.log("image::ruta=>::>",e[n]),i.append("images[]",e[n],`image_${n}.jpg`);return this.httpClient.post(this.urlApiProd,i)}catch(i){console.error("Error al enviar im\xe1genes al API:",i)}}LoadPdfInformeTecnico(e){let r=JSON.stringify({acc:14,idchecklistcab:e});return this.httpClient.post(this.urlApiProd,r).toPromise().then(c=>c)}deleteImage(e){return this.httpClient.delete(`${this.urlApiProd}?acc=16&id=${e}`)}}return(v=C).\u0275fac=function(e){return new(e||v)(f.LFG(d.eN),f.LFG(a.K))},v.\u0275prov=f.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),C})()},2087:(I,P,l)=>{function f(){const d=new FileReader;return d.__zone_symbol__originalInstance||d}l.d(P,{y3:()=>f})},798:(I,P,l)=>{l.r(P),l.d(P,{MttoWinInformeTablero4Page:()=>n});var m=l(5861),g=l(6814),f=l(2519),d=l(95),a=l(6728),O=l(1461),v=l(2087),C=l(8162),t=l(6242),e=l(1991),r=l(6172),c=l(4160);function i(p,A){if(1&p){const b=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",22),t._UZ(2,"ion-img",23),t.qZA(),t._UZ(3,"ion-img",23),t.TgZ(4,"ion-label"),t._uU(5),t.qZA(),t.TgZ(6,"ion-button",24),t.NdJ("click",function(){const s=t.CHM(b),u=s.$implicit,h=s.index,_=t.oxw();return t.KtG(_.deleteImage(u.idadjunto,h))}),t._UZ(7,"ion-icon",25),t.qZA()()}if(2&p){const b=A.$implicit,o=t.oxw();t.xp6(2),t.Q6J("src",o.DirectorioFotos+b.idnomadjunto),t.xp6(1),t.Q6J("src",b.webviewPath),t.xp6(2),t.Oqu(b.name)}}let n=(()=>{var p;class A{constructor(o,s,u,h,_,E,F,B){this.formBuilder=o,this.alertController=s,this.loadingController=u,this.ApiService1=h,this.ref=_,this.actionSheetCtrl=E,this.globalVal=F,this.ApiService=B,this.imgs=[],this.imageBlobs=[],this.images=[],this.DirectorioFotos=f.N.UrlDomainLocal+"aw_file/adjuntos/",this.checklist_paso1_apli_ck=!1,this.convertBlobToBase64=M=>new Promise((G,R)=>{this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(D=>{D.present()}),new FileReader;let Z=(0,v.y3)();Z.readAsDataURL(M),Z.onload=D=>{let T;T=D.target.result,T=this.dataURLtoBlob(T),this.ApiService.uploadImage(T,this.globalVal.corre_inf_cab,"png").subscribe(y=>{this.loadingController.dismiss(),this.loadImages(this.globalVal.corre_inf_cab),console.log("salio okkkk::",y)},y=>{console.log("error__::>",y)})}}).finally(()=>{console.log("convertBlobToBase64:::",this.convertBlobToBase64)}),this.FormCheckListPaso4=this.formBuilder.group({manioper:[""],estgab:[""],basesopt:[""],analisis:[""],obser3:[""],corre_inf_cab:[""],estado_informe:[""]})}ionViewWillEnter(){let o;this.checklist_paso1_apli_ck="0"==this.globalVal.checklist_paso1_apli,this.FLoadForms(),o={detail:{checked:this.checklist_paso1_apli_ck,jc:0}}}FLoadForms(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(s=>{s.present(),this.ApiService1.FormFindinftab1(this.globalVal.corre_inf_cab).then(u=>{console.log(this.globalVal.corre_inf_cab),this.EditDataRest1=u.list;try{this.FormCheckListPaso4.setValue({corre_inf_cab:this.globalVal.corre_inf_cab,manioper:this.EditDataRest1[0].manioper,estgab:this.EditDataRest1[0].estgab,basesopt:this.EditDataRest1[0].basesopt,analisis:this.EditDataRest1[0].analisis,obser3:this.EditDataRest1[0].obser3,estado_informe:""}),this.loadImages(this.globalVal.corre_inf_cab)}catch(h){console.log("error:::>",h)}}).finally(()=>{this.loadingController.dismiss()})})}SaveFormInfPaso1(){var o=this;this.alertSiNo=this.alertController.create({header:"INFORME TECNICO",subHeader:"DATOS GENERALES",mode:"ios",backdropDismiss:!0,cssClass:"alerta-ok",message:"Confirmar que desea guardar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(s=>{s.present(),s.onDidDismiss().then(u=>{"A"==u.role&&(this.loadingController.create({message:"Guardando datos generales...",translucent:!0}).then(_=>{_.present()}),this.FormCheckListPaso4.controls.corre_inf_cab.setValue(this.globalVal.corre_inf_cab),this.ApiService.GuardarinfPaso4(this.FormCheckListPaso4.value).then(function(){var _=(0,m.Z)(function*(E){o.loadingController.dismiss();let F="0"==E[0].o_nres?"alerta-error":"alerta-ok";yield(yield o.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"DATOS GENERALES",cssClass:F,mode:"ios",animated:!0,message:E[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada")}}]})).present()});return function(E){return _.apply(this,arguments)}}()).finally(()=>{}).catch(_=>{console.log("errror:::>>>>>>>>>",_)}))})})}selectImageSource(){var o=this;return(0,m.Z)(function*(){const s=[{text:"Tome una Foto",icon:"camera",handler:()=>{console.log(C.oK.Camera),o.addNewToGallery(1)}},{text:"Elegir desde las fotos",icon:"image",handler:()=>{console.log("Photos",C.oK.Photos),o.pickImages_buton()}}];yield(yield o.actionSheetCtrl.create({header:"Selecionar Image",buttons:s})).present()})()}pickImages_buton(){var o=this;return(0,m.Z)(function*(){const s={width:800,height:800,quality:100,correctOrientation:!0};try{const h=(yield C.V1.pickImages(s)).photos;o.imgs=[],o.imageBlobs=[];for(let _=0;_<h.length;_++)o.imgs.push(h[_].webPath);o.sendImages()}catch(u){console.error("Error picking images",u)}})()}sendImages(){this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(o=>{o.present()}),Promise.all(this.imgs.map(o=>this.convertAndAddToBlobs(o))).then(()=>{this.ApiService.UpLoadImageMultiple(this.imageBlobs,this.globalVal.corre_inf_cab,"png").subscribe(s=>{this.loadingController.dismiss(),this.loadImages(this.globalVal.corre_inf_cab),console.log("salio okkkk::",s)},s=>{console.log("error__::>",s)})}).catch(o=>{console.error("Error converting and adding Blobs",o)})}loadImages(o){this.ApiService.getImages(o).subscribe(s=>{this.images=s,this.ref.detectChanges()})}convertAndAddToBlobs(o){var s=this;return(0,m.Z)(function*(){try{console.log("convertAndAddToBlobs",o);const u=yield s.getBlobFromImagePath(o);s.addImageBlob(u)}catch(u){console.error("Error converting image to Blob",u)}})()}addImageBlob(o){this.imageBlobs.push(o)}getBlobFromImagePath(o){return(0,m.Z)(function*(){return yield(yield fetch(o)).blob()})()}addNewToGallery(o){var s=this;return(0,m.Z)(function*(){let u;console.log("addNewToGallery::::tp::::>",o),1==o&&(u=yield C.V1.getPhoto({resultType:C.dk.Uri,source:C.oK.Camera,quality:100,width:800,height:800}).finally(()=>{console.log("capturedPhoto::::",u)})),yield s.savePicture(u)})()}savePicture(o){var s=this;return(0,m.Z)(function*(){const u=yield s.readAsBase64(o),h=(new Date).getTime()+".jpeg";return yield O.fy.writeFile({path:h,data:u,directory:O.tP.Data}),{filepath:h,webviewPath:o.webPath}})()}readAsBase64(o){var s=this;return(0,m.Z)(function*(){const h=yield(yield fetch(o.webPath)).blob();return yield s.convertBlobToBase64(h)})()}dataURLtoBlob(o){console.log("dentro fucion dataURLtoBlob:",o);for(var s=o.split(","),u=s[0].match(/:(.*?);/)[1],h=atob(s[1]),_=h.length,E=new Uint8Array(_);_--;)E[_]=h.charCodeAt(_);return new Blob([E],{type:u})}ngOnInit(){}deleteImage(o,s){this.alertSiNo=this.alertController.create({header:"INFORME TECNICO",subHeader:"GENERAL",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea eliminar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(u=>{u.present(),u.onDidDismiss().then(h=>{console.log("aceptaPop::::>>",h),"A"==h.role&&this.ApiService.deleteImage(o).subscribe(_=>{this.images.splice(s,1)})})})}}return(p=A).\u0275fac=function(o){return new(o||p)(t.Y36(d.QS),t.Y36(a.Br),t.Y36(a.HT),t.Y36(e.k),t.Y36(t.sBO),t.Y36(a.BX),t.Y36(r.X),t.Y36(c.J))},p.\u0275cmp=t.Xpm({type:p,selectors:[["app-mtto-win-informe-tablero4"]],standalone:!0,features:[t.jDz],decls:53,vars:18,consts:[["mode","ios"],["text-capitalize",""],[3,"formGroup"],["mode","ios",1,"ion-no-padding"],["position","floating"],["mode","ios","formControlName","manioper",3,"autoGrow","autofocus"],["mode","ios","formControlName","estgab",3,"autoGrow","autofocus"],["mode","ios","formControlName","basesopt",3,"autoGrow","autofocus"],["color","danger"],["mode","ios","formControlName","analisis",3,"autoGrow","autofocus"],["mode","ios","formControlName","obser3",3,"autoGrow","autofocus"],["expand","block"],["slot","end",3,"click"],["name","camera"],[4,"ngFor","ngForOf"],[2,"text-align","center"],["mode","ios","formControlName","estado_informe",1,"ion_segment_3d",2,"width","110%"],["value","1","layout","icon-end",3,"click"],["name","close","color","danger"],["value","2","layout","icon-end",3,"click"],["color","success","name","checkmark"],["color","success"],["slot","start"],[3,"src"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(o,s){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-title",1)(4,"ion-label"),t._uU(5,"PARTE MECANICA"),t.qZA()()()()(),t.TgZ(6,"ion-content")(7,"form",2)(8,"ion-list",3)(9,"ion-item")(10,"ion-label",4),t._uU(11," Manija de operaci\xf3n: "),t.qZA(),t._UZ(12,"ion-textarea",5),t.qZA(),t.TgZ(13,"ion-item")(14,"ion-label",4),t._uU(15," Estado de gabinete (Orejas, seguros, bisagras,puntos de conexi\xf3n) "),t.qZA(),t._UZ(16,"ion-textarea",6),t.qZA(),t.TgZ(17,"ion-item")(18,"ion-label",4),t._uU(19," Base soporte de tablero el\xe9ctrico: "),t.qZA(),t._UZ(20,"ion-textarea",7),t.qZA(),t.TgZ(21,"ion-item-group")(22,"ion-item-divider",8)(23,"ion-label"),t._uU(24,"Analisis de Falla"),t.qZA()(),t.TgZ(25,"ion-item"),t._UZ(26,"ion-textarea",9),t.qZA(),t.TgZ(27,"ion-item")(28,"ion-label",4),t._uU(29," Otros: "),t.qZA(),t._UZ(30,"ion-textarea",10),t.qZA()(),t.TgZ(31,"ion-item",11),t._uU(32,"Fotos: "),t.TgZ(33,"ion-fab-button",12),t.NdJ("click",function(){return s.selectImageSource()}),t._UZ(34,"ion-icon",13),t.qZA()(),t.TgZ(35,"ion-list"),t.YNc(36,i,8,3,"ion-item",14),t.qZA()()()(),t.TgZ(37,"ion-footer")(38,"form",2)(39,"ion-grid")(40,"ion-row"),t._UZ(41,"ion-col"),t.TgZ(42,"ion-col",15)(43,"ion-segment",16)(44,"ion-segment-button",17),t.NdJ("click",function(){return s.SaveFormInfPaso1()}),t._UZ(45,"ion-icon",18),t.TgZ(46,"ion-label",8),t._uU(47,"BORRADOR"),t.qZA()(),t.TgZ(48,"ion-segment-button",19),t.NdJ("click",function(){return s.SaveFormInfPaso1()}),t._UZ(49,"ion-icon",20),t.TgZ(50,"ion-label",21),t._uU(51,"TERMINADO"),t.qZA()()()(),t._UZ(52,"ion-col"),t.qZA()()()()),2&o&&(t.xp6(7),t.Q6J("formGroup",s.FormCheckListPaso4),t.xp6(5),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(6),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(4),t.Q6J("autoGrow",!0)("autofocus",!0)("autoGrow",!0),t.xp6(6),t.Q6J("ngForOf",s.images),t.xp6(2),t.Q6J("formGroup",s.FormCheckListPaso4))},dependencies:[a.Pc,a.YG,a.wI,a.W2,a.W4,a.fr,a.jY,a.Gu,a.gu,a.Xz,a.Ie,a.rH,a.Ub,a.Q$,a.q_,a.Nd,a.cJ,a.GO,a.g2,a.Bs,a.wd,a.sr,a.QI,a.j9,g.ez,g.sg,d.u5,d._Y,d.JJ,d.JL,d.UX,d.sg,d.u]}),A})()}}]);