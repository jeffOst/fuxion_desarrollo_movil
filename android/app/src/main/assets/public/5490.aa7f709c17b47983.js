"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5490,6172,7152,7779,1902,6039,7016,8553,1490,5494,7007,5932,3475,3605,7756,6400,7969,6041,3541,9974,2966,1758],{5961:(O,v,o)=>{o.d(v,{GW:()=>p,dk:()=>_,oK:()=>l});var l=function(a){return a.Prompt="PROMPT",a.Camera="CAMERA",a.Photos="PHOTOS",a}(l||{}),p=function(a){return a.Rear="REAR",a.Front="FRONT",a}(p||{}),_=function(a){return a.Uri="uri",a.Base64="base64",a.DataUrl="dataUrl",a}(_||{})},8162:(O,v,o)=>{o.d(v,{V1:()=>_,dk:()=>p.dk,oK:()=>p.oK});var l=o(2726),p=o(5961);const _=(0,l.fo)("Camera",{web:()=>o.e(6468).then(o.bind(o,6468)).then(a=>new a.CameraWeb)})},5346:(O,v,o)=>{o.d(v,{ez:()=>p,tP:()=>l});var l=function(g){return g.Documents="DOCUMENTS",g.Data="DATA",g.Library="LIBRARY",g.Cache="CACHE",g.External="EXTERNAL",g.ExternalStorage="EXTERNAL_STORAGE",g}(l||{}),p=function(g){return g.UTF8="utf8",g.ASCII="ascii",g.UTF16="utf16",g}(p||{})},1461:(O,v,o)=>{o.d(v,{fy:()=>_,tP:()=>p.tP});var l=o(2726),p=o(5346);const _=(0,l.fo)("Filesystem",{web:()=>o.e(4522).then(o.bind(o,4522)).then(a=>new a.FilesystemWeb)})},4771:(O,v,o)=>{o.d(v,{Q:()=>d});var l=o(5861),p=o(2519),_=o(6242),a=o(9862),g=o(2014);let d=(()=>{var E;class I{constructor(r,c){this.httpClient=r,this.storage=c,this.urlApiProd=p.N.UrlDomainLocal+"aw_modulos/mante/api/CApiCheckListHerramientras.php",this.confirmRequest=""}ListFindcheck(r,c,h,s,m){let P=JSON.stringify({acc:1,s:r,idusu:c,iddevice:h,SelectFiltra:s,SelectFiltra2:m});return this.httpClient.post(this.urlApiProd,P).toPromise().then(A=>A)}cargawin1(r,c){let h=JSON.stringify({acc:2,id_usuario:r,idreg:c});return this.httpClient.post(this.urlApiProd,h).toPromise().then(s=>s)}LisTecnicos(r){let c=JSON.stringify({acc:3,s:r});return this.httpClient.post(this.urlApiProd,c).toPromise().then(h=>h)}LisHerramienta(r){let c=JSON.stringify({acc:4,s:r});return this.httpClient.post(this.urlApiProd,c).toPromise().then(h=>h)}NewForm(r,c){let h=JSON.stringify({acc:5,idusu:r,cod:c});return this.httpClient.post(this.urlApiProd,h).toPromise().then(s=>s)}GuardarFormPaso1(r,c){var h=this;return(0,l.Z)(function*(){console.log("Dentro::GuardarFormulario::>",r);let m=h.urlApiProd,P=JSON.stringify({paramsToBd:r,idregistro:c});return console.log("dataPost",P),h.httpClient.post(m+"?acc=6",P).toPromise().then(A=>A)})()}GuardarFormPaso2(r,c,h){var s=this;return(0,l.Z)(function*(){return s.httpClient.post(s.urlApiProd+"?acc=7",JSON.stringify({row:r,idestado:h,IdUsuarioLocal:c})).toPromise()})()}GuardarlistHerra(r,c,h,s){var m=this;return(0,l.Z)(function*(){return m.httpClient.post(m.urlApiProd+"?acc=13",JSON.stringify({row:r,idestado:h,IdUsuarioLocal:c,idregistro:s})).toPromise()})()}uploadImage(r,c,h){let s=new FormData;return s.append("file",r,"myimage."+h),s.append("id",c),s.append("acc","8"),s.append("type","image/png"),this.httpClient.post(this.urlApiProd,s)}getImages(r){return this.httpClient.get(`${this.urlApiProd}?acc=9&id=`+r)}UpLoadImageMultiple(r,c,h){try{let s=new FormData;s.append("id",c),s.append("acc","10"),s.append("type","image/png");for(let m=0;m<r.length;m++)console.log("image::ruta=>::>",r[m]),s.append("images[]",r[m],`image_${m}.jpg`);return this.httpClient.post(this.urlApiProd,s)}catch(s){console.error("Error al enviar im\xe1genes al API:",s)}}deleteImage(r){return this.httpClient.delete(`${this.urlApiProd}?acc=11&id=${r}`)}Lisherra(r,c,h){let s=JSON.stringify({acc:12,s:r,usuario:c,idregistro:h});return this.httpClient.post(this.urlApiProd,s).toPromise().then(m=>m)}}return(E=I).\u0275fac=function(r){return new(r||E)(_.LFG(a.eN),_.LFG(g.K))},E.\u0275prov=_.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),I})()},6172:(O,v,o)=>{o.d(v,{X:()=>p});var l=o(6242);let p=(()=>{var _;class a{constructor(){console.log("UserProfileService.Constructor invoked.")}}return(_=a).\u0275fac=function(d){return new(d||_)},_.\u0275prov=l.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),a})()},2087:(O,v,o)=>{function _(){const a=new FileReader;return a.__zone_symbol__originalInstance||a}o.d(v,{y3:()=>_})},5490:(O,v,o)=>{o.r(v),o.d(v,{PopUpImagenHerraPage:()=>m});var l=o(5861),p=o(2519),_=o(6814),a=o(95),g=o(2087),d=o(6728),E=o(1461),I=o(8162),t=o(6242),r=o(5472),c=o(4771),h=o(6172);function s(P,A){if(1&P){const C=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",1),t._UZ(2,"ion-img",9),t.qZA(),t._UZ(3,"ion-img",9),t.TgZ(4,"ion-label"),t._uU(5),t.qZA(),t.TgZ(6,"ion-button",10),t.NdJ("click",function(){const i=t.CHM(C),n=i.$implicit,u=i.index,f=t.oxw();return t.KtG(f.deleteImage(n.idadjunto,u))}),t._UZ(7,"ion-icon",11),t.qZA()()}if(2&P){const C=A.$implicit,e=t.oxw();t.xp6(2),t.Q6J("src",e.DirectorioFotos+C.idnomadjunto),t.xp6(1),t.Q6J("src",C.webviewPath),t.xp6(2),t.Oqu(C.name)}}let m=(()=>{var P;class A{constructor(e,i,n,u,f,D,B,M){this.loadingController=e,this.modalCtrl=i,this.ApiService=n,this.navParams=u,this.alertController=f,this.globalVal=D,this.actionSheetCtrl=B,this.ref=M,this.DirectorioFotos=p.N.UrlDomainLocal+"aw_file/adjuntos/",this.images=[],this.imgs=[],this.imageBlobs=[],this.convertBlobToBase64=L=>new Promise((R,Z)=>{this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(T=>{T.present()}),new FileReader;let U=(0,g.y3)();U.readAsDataURL(L),U.onload=T=>{let b;b=T.target.result,b=this.dataURLtoBlob(b),this.ApiService.uploadImage(b,this.idregistro,"png").subscribe(y=>{this.loadingController.dismiss(),this.loadImages(this.idregistro),console.log("salio okkkk::",y)},y=>{console.log("error__::>",y)})}}).finally(()=>{console.log("convertBlobToBase64:::",this.convertBlobToBase64)}),this.idregistro=this.navParams.get("idregistro"),this.id_personal=u.get("id_personal"),this.tecnico_cl=u.get("tecnico_cl"),this.cargo=u.get("cargo")}ngOnInit(){this.loadImages(this.idregistro)}selectImageSource(){var e=this;return(0,l.Z)(function*(){const i=[{text:"Tome una Foto",icon:"camera",handler:()=>{console.log(I.oK.Camera),e.addNewToGallery(1)}},{text:"Elegir desde las fotos",icon:"image",handler:()=>{console.log("Photos",I.oK.Photos),e.pickImages_buton()}}];yield(yield e.actionSheetCtrl.create({header:"Selecionar Image",buttons:i})).present()})()}addNewToGallery(e){var i=this;return(0,l.Z)(function*(){let n;console.log("addNewToGallery::::tp::::>",e),1==e&&(n=yield I.V1.getPhoto({resultType:I.dk.Uri,source:I.oK.Camera,quality:100,width:800,height:800}).finally(()=>{console.log("capturedPhoto::::",n)})),yield i.savePicture(n)})()}savePicture(e){var i=this;return(0,l.Z)(function*(){const n=yield i.readAsBase64(e),u=(new Date).getTime()+".jpeg";yield E.fy.writeFile({path:u,data:n,directory:E.tP.Data})})()}readAsBase64(e){var i=this;return(0,l.Z)(function*(){const u=yield(yield fetch(e.webPath)).blob();return yield i.convertBlobToBase64(u)})()}dataURLtoBlob(e){console.log("dentro fucion dataURLtoBlob:",e);for(var i=e.split(","),n=i[0].match(/:(.*?);/)[1],u=atob(i[1]),f=u.length,D=new Uint8Array(f);f--;)D[f]=u.charCodeAt(f);return new Blob([D],{type:n})}loadImages(e){this.ApiService.getImages(e).subscribe(i=>{this.images=i,this.ref.detectChanges()})}pickImages_buton(){var e=this;return(0,l.Z)(function*(){const i={width:800,height:800,quality:100,correctOrientation:!0};try{const u=(yield I.V1.pickImages(i)).photos;e.imgs=[],e.imageBlobs=[];for(let f=0;f<u.length;f++)e.imgs.push(u[f].webPath);e.sendImages()}catch(n){console.error("Error picking images",n)}})()}sendImages(){this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(e=>{e.present()}),Promise.all(this.imgs.map(e=>this.convertAndAddToBlobs(e))).then(()=>{this.ApiService.UpLoadImageMultiple(this.imageBlobs,this.idregistro,"png").subscribe(i=>{this.loadingController.dismiss(),this.loadImages(this.idregistro),console.log("salio okkkk::",i)},i=>{console.log("error__::>",i)})}).catch(e=>{console.error("Error converting and adding Blobs",e)})}getBlobFromImagePath(e){return(0,l.Z)(function*(){return yield(yield fetch(e)).blob()})()}addImageBlob(e){this.imageBlobs.push(e)}convertAndAddToBlobs(e){var i=this;return(0,l.Z)(function*(){try{console.log("convertAndAddToBlobs",e);const n=yield i.getBlobFromImagePath(e);i.addImageBlob(n)}catch(n){console.error("Error converting image to Blob",n)}})()}deleteImage(e,i){this.alertSiNo=this.alertController.create({header:"CHECKLIST",subHeader:"ALERTA",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea eliminar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(n=>{n.present(),n.onDidDismiss().then(u=>{console.log("aceptaPop::::>>",u),"A"==u.role&&(this.ApiService.deleteImage(e).subscribe(f=>{this.images.splice(i,1)}),this.loadImages(this.idregistro))})})}cancelar_listaservicios(e,i,n){var u=this;return(0,l.Z)(function*(){yield u.modalCtrl.dismiss({})})()}}return(P=A).\u0275fac=function(e){return new(e||P)(t.Y36(d.HT),t.Y36(d.IN),t.Y36(c.Q),t.Y36(r.X1),t.Y36(d.Br),t.Y36(h.X),t.Y36(d.BX),t.Y36(t.sBO))},P.\u0275cmp=t.Xpm({type:P,selectors:[["app-pop-up-imagen-herra"]],standalone:!0,features:[t.jDz],decls:17,vars:1,consts:[["mode","ios"],["slot","start"],[1,"",3,"click"],["part","icon","aria-hidden","true","role","img","name","chevron-back-outline",1,"md","hydrated"],["lines","none",1,"ion-text-center"],["color","success",3,"click"],["name","camera-reverse-outline"],["name","add-outline"],[4,"ngFor","ngForOf"],[3,"src"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3,"Subida de Imagenes"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t.NdJ("click",function(){return i.cancelar_listaservicios("","","")}),t._UZ(6,"ion-icon",3),t._uU(7," Atras "),t.qZA()()()(),t.TgZ(8,"ion-content")(9,"ion-item",4)(10,"ion-chip",5),t.NdJ("click",function(){return i.selectImageSource()}),t._UZ(11,"ion-icon",6),t.TgZ(12,"ion-label"),t._uU(13,"Agregar Imagen"),t.qZA(),t._UZ(14,"ion-icon",7),t.qZA()(),t.TgZ(15,"ion-list"),t.YNc(16,s,8,3,"ion-item",8),t.qZA()()),2&e&&(t.xp6(16),t.Q6J("ngForOf",i.images))},dependencies:[d.Pc,d.YG,d.Sm,d.hM,d.W2,d.Gu,d.gu,d.Xz,d.Ie,d.Q$,d.q_,d.Bs,d.wd,d.sr,_.ez,_.sg,a.u5]}),A})()}}]);