"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5490,4771,7287,9811],{5961:(O,v,o)=>{o.d(v,{GW:()=>f,dk:()=>p,oK:()=>c});var c=function(a){return a.Prompt="PROMPT",a.Camera="CAMERA",a.Photos="PHOTOS",a}(c||{}),f=function(a){return a.Rear="REAR",a.Front="FRONT",a}(f||{}),p=function(a){return a.Uri="uri",a.Base64="base64",a.DataUrl="dataUrl",a}(p||{})},8162:(O,v,o)=>{o.d(v,{V1:()=>p,dk:()=>f.dk,oK:()=>f.oK});var c=o(2726),f=o(5961);const p=(0,c.fo)("Camera",{web:()=>o.e(6468).then(o.bind(o,6468)).then(a=>new a.CameraWeb)})},5346:(O,v,o)=>{o.d(v,{ez:()=>f,tP:()=>c});var c=function(g){return g.Documents="DOCUMENTS",g.Data="DATA",g.Library="LIBRARY",g.Cache="CACHE",g.External="EXTERNAL",g.ExternalStorage="EXTERNAL_STORAGE",g}(c||{}),f=function(g){return g.UTF8="utf8",g.ASCII="ascii",g.UTF16="utf16",g}(f||{})},1461:(O,v,o)=>{o.d(v,{fy:()=>p,tP:()=>f.tP});var c=o(2726),f=o(5346);const p=(0,c.fo)("Filesystem",{web:()=>o.e(4522).then(o.bind(o,4522)).then(a=>new a.FilesystemWeb)})},4771:(O,v,o)=>{o.d(v,{Q:()=>h});var c=o(5861),f=o(2519),p=o(6242),a=o(9862),g=o(2014);let h=(()=>{var A;class I{constructor(r,l){this.httpClient=r,this.storage=l,this.urlApiProd=f.N.UrlDomainLocal+"aw_modulos/mante/api/CApiCheckListHerramientras.php",this.confirmRequest=""}ListFindcheck(r,l,d,s,u){let m=JSON.stringify({acc:1,s:r,idusu:l,iddevice:d,SelectFiltra:s,SelectFiltra2:u});return this.httpClient.post(this.urlApiProd,m).toPromise().then(E=>E)}cargawin1(r,l){let d=JSON.stringify({acc:2,id_usuario:r,idreg:l});return this.httpClient.post(this.urlApiProd,d).toPromise().then(s=>s)}LisTecnicos(r){let l=JSON.stringify({acc:3,s:r});return this.httpClient.post(this.urlApiProd,l).toPromise().then(d=>d)}LisHerramienta(r){let l=JSON.stringify({acc:4,s:r});return this.httpClient.post(this.urlApiProd,l).toPromise().then(d=>d)}NewForm(r,l){let d=JSON.stringify({acc:5,idusu:r,cod:l});return this.httpClient.post(this.urlApiProd,d).toPromise().then(s=>s)}GuardarFormPaso1(r,l){var d=this;return(0,c.Z)(function*(){console.log("Dentro::GuardarFormulario::>",r);let u=d.urlApiProd,m=JSON.stringify({paramsToBd:r,idregistro:l});return console.log("dataPost",m),d.httpClient.post(u+"?acc=6",m).toPromise().then(E=>E)})()}GuardarFormPaso2(r,l,d){var s=this;return(0,c.Z)(function*(){return s.httpClient.post(s.urlApiProd+"?acc=7",JSON.stringify({row:r,idestado:d,IdUsuarioLocal:l})).toPromise()})()}GuardarlistHerra(r,l,d,s){var u=this;return(0,c.Z)(function*(){return u.httpClient.post(u.urlApiProd+"?acc=13",JSON.stringify({row:r,idestado:d,IdUsuarioLocal:l,idregistro:s})).toPromise()})()}uploadImage(r,l,d){let s=new FormData;return s.append("file",r,"myimage."+d),s.append("id",l),s.append("acc","8"),s.append("type","image/png"),this.httpClient.post(this.urlApiProd,s)}getImages(r){return this.httpClient.get(`${this.urlApiProd}?acc=9&id=`+r)}UpLoadImageMultiple(r,l,d){try{let s=new FormData;s.append("id",l),s.append("acc","10"),s.append("type","image/png");for(let u=0;u<r.length;u++)console.log("image::ruta=>::>",r[u]),s.append("images[]",r[u],`image_${u}.jpg`);return this.httpClient.post(this.urlApiProd,s)}catch(s){console.error("Error al enviar im\xe1genes al API:",s)}}deleteImage(r){return this.httpClient.delete(`${this.urlApiProd}?acc=11&id=${r}`)}Lisherra(r,l,d){let s=JSON.stringify({acc:12,s:r,usuario:l,idregistro:d});return this.httpClient.post(this.urlApiProd,s).toPromise().then(u=>u)}}return(A=I).\u0275fac=function(r){return new(r||A)(p.LFG(a.eN),p.LFG(g.K))},A.\u0275prov=p.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),I})()},2087:(O,v,o)=>{function p(){const a=new FileReader;return a.__zone_symbol__originalInstance||a}o.d(v,{y3:()=>p})},5490:(O,v,o)=>{o.r(v),o.d(v,{PopUpImagenHerraPage:()=>u});var c=o(5861),f=o(2519),p=o(6814),a=o(95),g=o(2087),h=o(6728),A=o(1461),I=o(8162),t=o(6242),r=o(5472),l=o(4771),d=o(6172);function s(m,E){if(1&m){const C=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",1),t._UZ(2,"ion-img",9),t.qZA(),t._UZ(3,"ion-img",9),t.TgZ(4,"ion-label"),t._uU(5),t.qZA(),t.TgZ(6,"ion-button",10),t.NdJ("click",function(){const i=t.CHM(C),n=i.$implicit,_=i.index,P=t.oxw();return t.KtG(P.deleteImage(n.idadjunto,_))}),t._UZ(7,"ion-icon",11),t.qZA()()}if(2&m){const C=E.$implicit,e=t.oxw();t.xp6(2),t.Q6J("src",e.DirectorioFotos+C.idnomadjunto),t.xp6(1),t.Q6J("src",C.webviewPath),t.xp6(2),t.Oqu(C.name)}}let u=(()=>{var m;class E{constructor(e,i,n,_,P,b,B,M){this.loadingController=e,this.modalCtrl=i,this.ApiService=n,this.navParams=_,this.alertController=P,this.globalVal=b,this.actionSheetCtrl=B,this.ref=M,this.DirectorioFotos=f.N.UrlDomainLocal+"aw_file/adjuntos/",this.images=[],this.imgs=[],this.imageBlobs=[],this.convertBlobToBase64=L=>new Promise((R,Z)=>{this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(T=>{T.present()}),new FileReader;let U=(0,g.y3)();U.readAsDataURL(L),U.onload=T=>{let D;D=T.target.result,D=this.dataURLtoBlob(D),this.ApiService.uploadImage(D,this.idregistro,"png").subscribe(y=>{this.loadingController.dismiss(),this.loadImages(this.idregistro),console.log("salio okkkk::",y)},y=>{console.log("error__::>",y)})}}).finally(()=>{console.log("convertBlobToBase64:::",this.convertBlobToBase64)}),this.idregistro=this.navParams.get("idregistro"),this.id_personal=_.get("id_personal"),this.tecnico_cl=_.get("tecnico_cl"),this.cargo=_.get("cargo")}ngOnInit(){this.loadImages(this.idregistro)}selectImageSource(){var e=this;return(0,c.Z)(function*(){const i=[{text:"Tome una Foto",icon:"camera",handler:()=>{console.log(I.oK.Camera),e.addNewToGallery(1)}},{text:"Elegir desde las fotos",icon:"image",handler:()=>{console.log("Photos",I.oK.Photos),e.pickImages_buton()}}];yield(yield e.actionSheetCtrl.create({header:"Selecionar Image",buttons:i})).present()})()}addNewToGallery(e){var i=this;return(0,c.Z)(function*(){let n;console.log("addNewToGallery::::tp::::>",e),1==e&&(n=yield I.V1.getPhoto({resultType:I.dk.Uri,source:I.oK.Camera,quality:100,width:800,height:800}).finally(()=>{console.log("capturedPhoto::::",n)})),yield i.savePicture(n)})()}savePicture(e){var i=this;return(0,c.Z)(function*(){const n=yield i.readAsBase64(e),_=(new Date).getTime()+".jpeg";yield A.fy.writeFile({path:_,data:n,directory:A.tP.Data})})()}readAsBase64(e){var i=this;return(0,c.Z)(function*(){const _=yield(yield fetch(e.webPath)).blob();return yield i.convertBlobToBase64(_)})()}dataURLtoBlob(e){console.log("dentro fucion dataURLtoBlob:",e);for(var i=e.split(","),n=i[0].match(/:(.*?);/)[1],_=atob(i[1]),P=_.length,b=new Uint8Array(P);P--;)b[P]=_.charCodeAt(P);return new Blob([b],{type:n})}loadImages(e){this.ApiService.getImages(e).subscribe(i=>{this.images=i,this.ref.detectChanges()})}pickImages_buton(){var e=this;return(0,c.Z)(function*(){const i={width:800,height:800,quality:100,correctOrientation:!0};try{const _=(yield I.V1.pickImages(i)).photos;e.imgs=[],e.imageBlobs=[];for(let P=0;P<_.length;P++)e.imgs.push(_[P].webPath);e.sendImages()}catch(n){console.error("Error picking images",n)}})()}sendImages(){this.popLodingMenaje=this.loadingController.create({message:"Guardando foto...",translucent:!0}).then(e=>{e.present()}),Promise.all(this.imgs.map(e=>this.convertAndAddToBlobs(e))).then(()=>{this.ApiService.UpLoadImageMultiple(this.imageBlobs,this.idregistro,"png").subscribe(i=>{this.loadingController.dismiss(),this.loadImages(this.idregistro),console.log("salio okkkk::",i)},i=>{console.log("error__::>",i)})}).catch(e=>{console.error("Error converting and adding Blobs",e)})}getBlobFromImagePath(e){return(0,c.Z)(function*(){return yield(yield fetch(e)).blob()})()}addImageBlob(e){this.imageBlobs.push(e)}convertAndAddToBlobs(e){var i=this;return(0,c.Z)(function*(){try{console.log("convertAndAddToBlobs",e);const n=yield i.getBlobFromImagePath(e);i.addImageBlob(n)}catch(n){console.error("Error converting image to Blob",n)}})()}deleteImage(e,i){this.alertSiNo=this.alertController.create({header:"CHECKLIST",subHeader:"ALERTA",mode:"ios",backdropDismiss:!0,message:"Confirmar que desea eliminar?",buttons:[{text:"Aceptar",cssClass:"alert-button-group",role:"A",handler:()=>{}},{text:"Cancelar",role:"F",handler:()=>{}}]}).then(n=>{n.present(),n.onDidDismiss().then(_=>{console.log("aceptaPop::::>>",_),"A"==_.role&&(this.ApiService.deleteImage(e).subscribe(P=>{this.images.splice(i,1)}),this.loadImages(this.idregistro))})})}cancelar_listaservicios(e,i,n){var _=this;return(0,c.Z)(function*(){yield _.modalCtrl.dismiss({})})()}}return(m=E).\u0275fac=function(e){return new(e||m)(t.Y36(h.HT),t.Y36(h.IN),t.Y36(l.Q),t.Y36(r.X1),t.Y36(h.Br),t.Y36(d.X),t.Y36(h.BX),t.Y36(t.sBO))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-pop-up-imagen-herra"]],standalone:!0,features:[t.jDz],decls:17,vars:1,consts:[["mode","ios"],["slot","start"],[1,"",3,"click"],["part","icon","aria-hidden","true","role","img","name","chevron-back-outline",1,"md","hydrated"],["lines","none",1,"ion-text-center"],["color","success",3,"click"],["name","camera-reverse-outline"],["name","add-outline"],[4,"ngFor","ngForOf"],[3,"src"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash-outline"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3,"Subida de Imagenes"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t.NdJ("click",function(){return i.cancelar_listaservicios("","","")}),t._UZ(6,"ion-icon",3),t._uU(7," Atras "),t.qZA()()()(),t.TgZ(8,"ion-content")(9,"ion-item",4)(10,"ion-chip",5),t.NdJ("click",function(){return i.selectImageSource()}),t._UZ(11,"ion-icon",6),t.TgZ(12,"ion-label"),t._uU(13,"Agregar Imagen"),t.qZA(),t._UZ(14,"ion-icon",7),t.qZA()(),t.TgZ(15,"ion-list"),t.YNc(16,s,8,3,"ion-item",8),t.qZA()()),2&e&&(t.xp6(16),t.Q6J("ngForOf",i.images))},dependencies:[h.Pc,h.YG,h.Sm,h.hM,h.W2,h.Gu,h.gu,h.Xz,h.Ie,h.Q$,h.q_,h.Bs,h.wd,h.sr,p.ez,p.sg,a.u5]}),E})()}}]);