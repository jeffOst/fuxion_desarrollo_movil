"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9610],{9610:(R,f,d)=>{d.r(f),d.d(f,{MttoWinOrdenTrabajo2Page:()=>x});var c=d(5861),p=d(6814),h=d(95),r=d(6728),T=d(9911),P=d(5974),t=d(6242),A=d(5472),C=d(1991),O=d(2014),E=d(4248),Z=d(6172);const D=["listenerOut"];function M(_,u){if(1&_){const l=t.EpF();t.TgZ(0,"ion-item-divider",17)(1,"ion-label"),t._uU(2,"\xa0"),t.TgZ(3,"strong"),t._uU(4),t.qZA()(),t.TgZ(5,"ion-chip",10),t.NdJ("click",function(){t.CHM(l);const e=t.oxw().$implicit,a=t.oxw();return t.KtG(a.agregarItem(e))}),t.TgZ(6,"ion-label"),t._uU(7,"Agregar"),t.qZA(),t._UZ(8,"ion-icon",11),t.qZA()()}if(2&_){const l=t.oxw().$implicit;t.xp6(4),t.Oqu(l.nomclase)}}function v(_,u){if(1&_){const l=t.EpF();t.TgZ(0,"ion-item",18)(1,"ion-badge",19),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",20),t.NdJ("click",function(e){t.CHM(l);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FItemEliminar(e,a))}),t._uU(4," Quitar "),t._UZ(5,"ion-icon",21),t.qZA(),t.TgZ(6,"ion-toggle",22),t.NdJ("ionChange",function(e){t.CHM(l);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FasignaServicio(e,a))}),t.TgZ(7,"p",23)(8,"ion-badge",24),t._uU(9),t.qZA(),t.TgZ(10,"ion-text",25),t._uU(11),t.qZA(),t._uU(12," Cnt.Teorica: "),t.TgZ(13,"ion-text",26),t._uU(14),t.qZA()()(),t.TgZ(15,"ion-input",27),t.NdJ("ngModelChange",function(e){t.CHM(l);const a=t.oxw().$implicit;return t.KtG(a.otd_cantidad=e)})("ionBlur",function(e){t.CHM(l);const a=t.oxw().$implicit,n=t.oxw();return t.KtG(n.FBlourInput(e,a))}),t.qZA()()}if(2&_){const l=t.oxw().$implicit;t.xp6(2),t.hij("",l.orden1,".-"),t.xp6(4),t.Q6J("disabled","0"===l.habilitar_toggle)("checked","1"===l.check_toggle),t.xp6(2),t.s9C("color",l.color_atendido),t.xp6(1),t.Oqu(l.estado_abre),t.xp6(2),t.Oqu(l.nomclase),t.xp6(3),t.Oqu(l.otd_cantidad_plan),t.xp6(1),t.Q6J("disabled","0"===l.habilitar_input)("ngModel",l.otd_cantidad)}}function y(_,u){if(1&_&&(t.TgZ(0,"ion-item-group"),t.YNc(1,M,9,1,"ion-item-divider",15)(2,v,16,9,"ion-item",16),t.qZA()),2&_){const l=u.$implicit;t.xp6(1),t.Q6J("ngIf","1"===l.orden),t.xp6(1),t.Q6J("ngIf","2"===l.orden)}}let x=(()=>{var _;class u{constructor(o,e,a,n,i,s,b,m,I,U,L){let g;this.navCtrl=o,this.loadingController=e,this.ApiService=a,this.storage=n,this.alertController=i,this.router=s,this.globalVal=b,this.ref=m,this.actionSheetCtrl=I,this.toastController=U,this.modalCtrl=L,this.DsServiciosxPieza={},this.ValuesAcordionGroup=["551571","551579"],this.itemsAcum=0,this.disabledBusquedaPartList=!0,this.storage.get("USER_INFO").then(j=>{g=j,this.NombresUsuarioLocal=g.user_name,this.IdUsuarioLocal=g.user_id,this.storage.get("DEVICE_INFO").then(W=>{g=W,this.NombreDispositivo=g.name,this.IdDispositivo=g.uuid})}),this.disabledBusquedaPartList="RB"!==this.globalVal.fab_rep}ngAfterViewInit(){this.itemsAcum=0}ngOnInit(){this.itemsAcum=0,this.param1=this.globalVal.fab_rep}get autoIncrement(){let o=0;for(const e of this.EditDataRest)"1"===e.item&&(o+=1);return o}ionViewWillEnter(){this.itemsAcum=0,this.FLoadPiezasAcordion()}FLoadPiezasAcordion(){this.loadingController.create({message:"Cargando lista....",translucent:!0}).then(e=>{e.present(),this.ApiService.ListRepuestosxBomba(this.globalVal.id_orden_trab_cab,this.IdUsuarioLocal).then(a=>{let n=0;this.itemsAcum=0,this.EditDataRest=a,console.log(this.EditDataRest),this.EditDataRest.forEach(i=>{"1"===i.item&&(this.itemsAcum++,this.EditDataRest[n].orden1=this.itemsAcum,this.mttoNombrePartList=this.EditDataRest[n].nombre_partlist_otc),n++})}).finally(()=>{this.loadingController.dismiss()})})}presentToast(o){var e=this;return(0,c.Z)(function*(){console.log("ingreso toast"),yield(yield e.toastController.create({message:o,duration:1500,position:"bottom"})).present()})()}FasignaServicio(o,e){var a=this;return(0,c.Z)(function*(){console.log(o),e.check_toggle=o.detail.checked?"1":"0",e.habilitar_input=o.detail.checked?"1":"0",yield a.ApiService.GuardarFormPaso2(e,a.IdUsuarioLocal).then(function(){var i=(0,c.Z)(function*(s){console.log(s),a.presentToast(s[0].o_msj),"1"==s[0].o_nres&&(e.otd_cantidad=e.otd_cantidad_plan)});return function(s){return i.apply(this,arguments)}}()).finally(()=>{}).catch(i=>{console.log("errror:::>>>>>>>>>",i)})})()}FBlourInput(o,e){var a=this;return(0,c.Z)(function*(){console.log(o),yield a.ApiService.GuardarFormPaso2(e,a.IdUsuarioLocal).then(function(){var i=(0,c.Z)(function*(s){console.log(s),a.presentToast(s[0].o_msj)});return function(s){return i.apply(this,arguments)}}()).finally(()=>{}).catch(i=>{console.log("errror:::>>>>>>>>>",i)}),o.preventDefault()})()}agregarItem(o){var e=this;return(0,c.Z)(function*(){console.log(o),console.log("codigo param",e.param1);const a=e.param1,n=yield e.modalCtrl.create({component:T.MttoOtisPopUpAddItemPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:o,param1:a}});return n.onDidDismiss().then(function(){var i=(0,c.Z)(function*(s){e.FLoadPiezasAcordion(),null!==s&&(console.log("DATA DEVUELTA",s.data),e.dataReturned=s.data,console.log("Modal Sent Data :",e.dataReturned),"1"==s.data.o_nres||console.log("no guardo nada"))});return function(s){return i.apply(this,arguments)}}()),yield n.present()})()}agregarItemSinPieza(){this.agregarItem({idclase:0,nomclase:"Sin Pieza Definida",rs:"1",id_orden_trab_cab:this.globalVal.id_orden_trab_cab})}mostrarConfirmacion(){var o=this;return(0,c.Z)(function*(){yield(yield o.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea realizar esta acci\xf3n?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{o.SaveFormTerminadoPaso1()}}]})).present()})()}SaveFormTerminadoPaso1(){var o=this;return(0,c.Z)(function*(){o.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(a=>{a.present()}),yield o.ApiService.GuardarOtTerminado(o.globalVal.id_orden_trab_cab,o.IdUsuarioLocal).then(function(){var a=(0,c.Z)(function*(n){o.loadingController.dismiss(),console.log(n);let i="0"==n[0].o_nres?"alerta-error":"alerta-ok";yield(yield o.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:i,mode:"ios",animated:!0,message:n[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{console.log("Operaci\xf3n confirmada"),"1"==n[0].o_nres&&o.navCtrl.navigateForward(["mtto-list-orden-trabajo"])}}]})).present()});return function(n){return a.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(a=>{console.log("errror:::>>>>>>>>>",a)})})()}FItemEliminar(o,e){var a=this;return(0,c.Z)(function*(){console.log(o,e),yield(yield a.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea quitar el item seleccionado?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{a.FQuitarItem(e)}}]})).present()})()}FQuitarItem(o){var e=this;return(0,c.Z)(function*(){e.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(i=>{i.present()});const n=[o];console.log('// Recorre el array y agrega la columna "idusuario" a cada objeto',o),n.forEach(i=>{i.IdUsuarioLocal=e.IdUsuarioLocal,i.acc=30}),console.log(n),yield e.ApiService.FQuitarItem(n[0]).then(function(){var i=(0,c.Z)(function*(s){if(e.loadingController.dismiss(),console.log(s),e.presentToast(s[0].o_msj),console.log(s[0].o_nres),"1"==s[0].o_nres){const m=e.EditDataRest.indexOf(o);m>-1&&e.EditDataRest.splice(m,1)}});return function(s){return i.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(i=>{console.log("errror:::>>>>>>>>>",i)})})()}cambiarPartList(){var o=this;return(0,c.Z)(function*(){let e={IdUsuarioLocal:o.IdUsuarioLocal,id_orden_trab_cab:o.globalVal.id_orden_trab_cab};const a=yield o.modalCtrl.create({component:P.MttoOtisPopUpAddPartListPage,backdropDismiss:!0,showBackdrop:!0,mode:"ios",componentProps:{row:e}});return a.onDidDismiss().then(function(){var n=(0,c.Z)(function*(i){o.FLoadPiezasAcordion(),null!==i&&(o.dataReturned=i.data,console.log("Modal Sent Data :",o.dataReturned),o.mttoNombrePartList=i.data.tipofuente,o.globalVal.nombre_partlist_otc=i.data.configuracion,"1"==i.data.o_nres||console.log("no guardo nada"))});return function(i){return n.apply(this,arguments)}}()),yield a.present()})()}mostrarConfirmacion_detalle(){var o=this;return(0,c.Z)(function*(){console.log("EditDataRest::",o.EditDataRest),console.log("count::>",o.EditDataRest.length),o.EditDataRest.length>0?yield(yield o.alertController.create({header:"Confirmaci\xf3n",message:"\xbfDesea cargar detalle, se perdera algun cambio previo en el detalle de los items que no esten aprobados?",cssClass:"alerta-confirma",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Acci\xf3n cancelada")}},{text:"Aceptar",handler:()=>{o.SavePartList()}}]})).present():o.SavePartList()})()}SavePartList(){var o=this;return(0,c.Z)(function*(){o.loadingController.create({message:"Guardando O.T...",translucent:!0}).then(a=>{a.present()}),yield o.ApiService.GuardarCargarDetalleOT(o.globalVal.id_orden_trab_cab,o.IdUsuarioLocal,o.globalVal.fab_rep).then(function(){var a=(0,c.Z)(function*(n){o.loadingController.dismiss(),console.log(n);let i="0"==n[0].o_nres?"alerta-error":"alerta-ok";yield(yield o.alertController.create({header:"ORDEN DE TRABAJO",subHeader:"MATERIALES",cssClass:i,mode:"ios",animated:!0,message:n[0].o_msj,buttons:[{text:"Aceptar",handler:()=>{"1"==n[0].o_nres&&o.FLoadPiezasAcordion()}}]})).present()});return function(n){return a.apply(this,arguments)}}()).finally(()=>{console.log("finally:::>>LN:394")}).catch(a=>{console.log("errror:::>>>>>>>>>",a)})})()}}return(_=u).\u0275fac=function(o){return new(o||_)(t.Y36(A.SH),t.Y36(r.HT),t.Y36(C.k),t.Y36(O.K),t.Y36(r.Br),t.Y36(E.F0),t.Y36(Z.X),t.Y36(t.sBO),t.Y36(r.BX),t.Y36(r.yF),t.Y36(r.IN))},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-mtto-win-orden-trabajo2"]],viewQuery:function(o,e){if(1&o&&t.Gf(D,7),2&o){let a;t.iGM(a=t.CRH())&&(e.listenerOut=a.first)}},standalone:!0,features:[t.jDz],decls:28,vars:5,consts:[["mode","ios"],["slot","start"],["color","success",3,"ngModel"],["slot","end",3,"disabled","click"],["name","search","slot","end"],[2,"padding","0px","border","0px"],["slot","end","color","primary",3,"outline","click"],["name","create"],["slot","end","color","primary",3,"click"],["name","refresh-outline"],["slot","end","mode","ios","color","primary",3,"click"],["name","add"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["expand","full","color","primary",3,"disabled","click"],["button","true","class","divider",4,"ngIf"],["style","border-style: hidden",4,"ngIf"],["button","true",1,"divider"],[2,"border-style","hidden"],["slot","start","color","medium","no-padding",""],["color","danger","slot","start","no-padding","",2,"margin-inline-end","2px",3,"click"],["name","trash","slot","start"],["mode","ios","labelPlacement","start",2,"width","98%","border-style","hidden",3,"disabled","checked","ionChange"],[2,"font-size","small","width","100%"],["slot","end","no-padding","",3,"color"],["color","primary"],["color","secondary"],["slot","end","type","number",2,"text-align","end","height","35px !important","width","13%","border-color","black","margin-inline-start","2px","border","1px",3,"disabled","ngModel","ngModelChange","ionBlur"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-item")(3,"ion-note",1),t._uU(4,"PartList:"),t.qZA(),t._UZ(5,"ion-input",2),t.TgZ(6,"ion-button",3),t.NdJ("click",function(){return e.cambiarPartList()}),t._UZ(7,"ion-icon",4),t._uU(8," Buscar "),t.qZA()(),t.TgZ(9,"ion-item",5)(10,"ion-chip",6),t.NdJ("click",function(){return e.mostrarConfirmacion_detalle()}),t._UZ(11,"ion-icon",7),t.TgZ(12,"ion-label"),t._uU(13,"Cargar Detalle"),t.qZA()(),t.TgZ(14,"ion-chip",8),t.NdJ("click",function(){return e.FLoadPiezasAcordion()}),t._UZ(15,"ion-icon",9),t.TgZ(16,"ion-label"),t._uU(17,"Actualizar"),t.qZA()(),t.TgZ(18,"ion-chip",10),t.NdJ("click",function(){return e.agregarItemSinPieza()}),t.TgZ(19,"ion-label"),t._uU(20,"Agregar"),t.qZA(),t._UZ(21,"ion-icon",11),t.qZA()()()(),t.TgZ(22,"ion-content",12)(23,"ion-list"),t.YNc(24,y,3,2,"ion-item-group",13),t.qZA()(),t.TgZ(25,"ion-footer")(26,"ion-button",14),t.NdJ("click",function(){return e.mostrarConfirmacion()}),t._uU(27,"Terminado"),t.qZA()()),2&o&&(t.xp6(5),t.Q6J("ngModel",e.mttoNombrePartList),t.xp6(1),t.Q6J("disabled",e.disabledBusquedaPartList),t.xp6(4),t.Q6J("outline",!0),t.xp6(14),t.Q6J("ngForOf",e.EditDataRest),t.xp6(2),t.Q6J("disabled",e.globalVal.ot_estado_general>"2"))},dependencies:[r.Pc,r.yp,r.YG,r.hM,r.W2,r.fr,r.Gu,r.gu,r.pK,r.Ie,r.rH,r.Ub,r.Q$,r.q_,r.uN,r.yW,r.ho,r.sr,r.w,r.as,r.j9,p.ez,p.sg,p.O5,h.u5,h.JJ,h.On],styles:[".divider[_ngcontent-%COMP%]{color:#000;font-weight:700;background-color:#d7d8da;padding:0!important;border-radius:5px;border-width:2px;font-weight:bolder}"]}),u})()}}]);